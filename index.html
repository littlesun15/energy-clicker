<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Energy Clicker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to bottom, #0b0c2a, #1a1e3f, #292f5c);
      color: #e0f7fa;
      margin: 0;
      padding: 20px;
      text-align: center;
      overflow-x: hidden;
    }
    canvas#starCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      pointer-events: none;
    }
    #timerBox {
      position: fixed;
      top: 20px;
      right: 40px;
      background: rgba(0,0,0,0.4);
      color: #ffd600;
      font-size: 2em;
      font-weight: bold;
      border-radius: 10px;
      padding: 10px 25px;
      z-index: 100;
      letter-spacing: 1px;
      display: none;
      text-shadow: 0 0 8px #ffecb3;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #ffffff;
      text-shadow: 0 0 10px #00bcd4;
    }
    #energy, #productionRate, #clickPower {
      font-size: 1.3em;
      font-weight: bold;
      color: #aefeff;
      text-shadow: 0 0 5px #26c6da;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 8px;
      border-radius: 12px;
      background: linear-gradient(to right, #0f9b8e, #00bcd4);
      color: #ffffff;
      border: 1px solid #00acc1;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
      background: linear-gradient(to right, #00acc1, #26c6da);
    }
    .panel {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 20px;
      margin: 20px auto;
      width: 90%;
      max-width: 350px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }
    .panel h3 {
      font-size: 1.3em;
      margin-bottom: 10px;
      color: #ffffff;
      text-shadow: 0 0 5px #80deea;
    }
    #restartButton, #retryButton {
      margin-top: 20px;
      background: #ff1744;
      border: 1px solid #f44336;
    }
    #restartButton:hover, #retryButton:hover {
      background: #ff5252;
      box-shadow: 0 0 10px rgba(255, 82, 82, 0.6);
    }
    #challengeMenu, #timeAttackMenu {
      display: none;
    }
    #challengeList button {
      margin: 20px;
      font-size: 1.2em;
      padding: 15px 35px;
      border-radius: 18px;
    }
  </style>
</head>
<body>
  <canvas id="starCanvas"></canvas>
  <!-- ë©”ì¸ ë©”ë‰´ -->
  <div id="mainMenu">
    <h1>âš¡ Energy Clicker</h1>
    <div id="mainDesc" style="margin: 15px 0 20px 0; font-size:1.1em; color:#b2ebf2; text-shadow:0 0 5px #26c6da;">
      í´ë¦­í•´ì„œ ì„ìœ ë¥¼ ì‹œì¶”í•˜ê³ ,<br>
      ë‹¤ì–‘í•œ ë°œì „ì†Œë¥¼ ê±´ì„¤í•´ ë‹¤ë¥¸ í–‰ì„±ì„ í…Œë¼í¬ë° í•˜ì„¸ìš”!<br><br>
      ì œì‘ì: ì •ì´ì¤€
    </div>
    <button onclick="startNewGame()">ğŸ® ìƒˆ ê²Œì„ ì‹œì‘</button>
    <button id="continueButton" onclick="continueGame()" style="display: none;">ğŸ’¾ ì €ì¥ëœ ê²Œì„ ì´ì–´í•˜ê¸°</button>
    <button onclick="showChallengeMenu()">ğŸš© ë„ì „</button>
    <button onclick="showNotice()">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
  </div>

  <div id="noticePanel" style="display:none;">
    <h1>ğŸ“¢ ê³µì§€ì‚¬í•­</h1>
    <div id="noticeContent" style="margin:20px; color:#e0f7fa; font-size:1.15em;">
      - íŒ¨ì¹˜ë…¸íŠ¸: 1.1.7v ìì˜ìì˜í•œ ê²ƒë“¤ ìˆ˜ì •,ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜(ìƒìŠ¹ë¥  1.1ë°°),ìƒˆë¡œìš´ ëª¨ë“œ ì¶”ê°€,ë²„ê·¸ ìˆ˜ì •<br>
      -1.1.8v ë²„ê·¸ ìˆ˜ì •<br>
      -1.2.0v ë¦¬ì…‹ ë²„íŠ¼ ì‚­ì œ,íƒ€ì„ì–´íƒ ëª¨ë“œ ì¼ì‹œì •ì§€ê°€ ìŠ¤í˜ì´ìŠ¤ë°”ì—ì„œ ë²„íŠ¼ìœ¼ë¡œ ë°”ë€œ,ìƒˆë¡œê³ ì¹¨ í•´ë„ ë¦¬ì…‹ ì•ˆë¨<br>
      -1.2.2v íƒ€ì„ì–´íƒ ëª¨ë“œì—ì„œ ì¼ì‹œì •ì§€ ìƒíƒœì¼ ë•Œ ë²„íŠ¼ì´ ì•ˆëˆŒë¦¼,ìˆ«ìì— ì‰¼í‘œê°€ ìƒê¹€<br>
      -1.2.5v ë’¤ì— ë°°ê²½ì´ ì¡°ê¸ˆ ë‹¤ì±„ë¡œì›Œì§<br>
      - ì´ ê²Œì„ì— ì¶”ê°€í•˜ê³  ì‹¶ì€ê±° ìˆìœ¼ì‹œë©´ ì¹´í†¡ì´ë‚˜ ë©”ì„¸ì§€ë¡œ ë³´ë‚´ì£¼ì„¸ìš”~<br><br>
      -í˜„ì¬ ë²„ì „: 1.2.5v
    </div>
    <button onclick="closeNotice()">ë‹«ê¸°</button>
  </div>

  <!-- ë„ì „ ëª¨ë“œ ë©”ë‰´ -->
  <div id="challengeMenu">
    <h1>ğŸš© ë„ì „ ëª¨ë“œ ì„ íƒ</h1>
    <div id="challengeList">
      <button onclick="showTimeAttackMenu()">â±ï¸ íƒ€ì„ì–´íƒ ëª¨ë“œ</button>
      <button onclick="showLandModeMenu()">ğŸŒ ë•… ë¶€ì¡± ëª¨ë“œ</button>
    </div>
    <button onclick="backToMainMenu()">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
  </div>
  <div id="landModeMenu" style="display:none;">
    <h1>ğŸŒ ë•… ë¶€ì¡± ëª¨ë“œ</h1>
    <div style="margin:10px 0 30px 0; font-size:1.05em;">
      ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œ ì œí•œ!<br>ì–¸ì œë“  ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥
    </div>
    <button onclick="startLimitedLandGame()">ğŸŒ± ìƒˆ ë•… ë¶€ì¡± ëª¨ë“œ ì‹œì‘</button>
    <button id="continueLandModeBtn" onclick="continueLimitedLandGame()" style="display:none;">ğŸ’¾ ì €ì¥ëœ ë•… ë¶€ì¡± ì´ì–´í•˜ê¸°</button>
    <button onclick="showChallengeMenu()">â† ë„ì „ ëª¨ë“œ ì„ íƒìœ¼ë¡œ</button>
  </div>
  <!-- íƒ€ì„ì–´íƒ ëª¨ë“œ ì‹œì‘ ë©”ë‰´ -->
  <div id="timeAttackMenu">
    <h1>â±ï¸ íƒ€ì„ì–´íƒ ëª¨ë“œ</h1>
    <div style="margin:10px 0 30px 0; font-size:1.05em;">25ë¶„ ì•ˆì— í…Œë¼í¬ë°ì„ ì„±ê³µí•˜ë©´ í´ë¦¬ì–´!<br>ì§„í–‰ ì¤‘ ì–¸ì œë“  ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥</div>
    <button onclick="startTimeAttackGame()">â° ìƒˆ íƒ€ì„ì–´íƒ ì‹œì‘</button>
    <button id="continueTimeAttackBtn" onclick="continueTimeAttackGame()" style="display:none;">ğŸ’¾ ì €ì¥ëœ íƒ€ì„ì–´íƒ ì´ì–´í•˜ê¸°</button>
    <button onclick="showChallengeMenu()">â† ë„ì „ ëª¨ë“œ ì„ íƒìœ¼ë¡œ</button>
  </div>
  <div id="timerBox"></div>
  <!-- ê²Œì„ í™”ë©´ -->
  <div id="gameScreen" style="display: none;">
    <audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f23b7d3083.mp3" preload="auto"></audio>
    <audio id="bgm" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_96e0576b8b.mp3" loop preload="auto"></audio>
    <div id="landLimitNotice" style="display:none; color:#ffcc80; font-weight:bold; margin-bottom:10px;">
      ğŸŒ <b>ë•… ë¶€ì¡± ëª¨ë“œ</b>: ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê±´ì„¤ ê°€ëŠ¥!
    </div>
    <h1>âš¡ Energy Clicker</h1>
    <div id="energy">ì—ë„ˆì§€: 0</div>
    <div id="productionRate">ì´ˆë‹¹ ìƒì‚°ëŸ‰: 0</div>
    <div id="clickPower">í´ë¦­ë‹¹ ì—ë„ˆì§€: 1</div>
    <button id="saveGameBtn" onclick="saveGame()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
    <button id="pauseButton" onclick="togglePause()" style="display:none;">â¸ï¸ ì¼ì‹œì •ì§€</button>
    <button id="gainEnergyBtn" onclick="gainEnergy()">âš¡ ì„ìœ  ì‹œì¶”í•˜ê¸°</button>
    <button onclick="backToMainMenu()">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
    <button id="showAchievementsBtn" onclick="showAchievements()">ğŸ† ì—…ì  ë³´ê¸°</button>
    <div class="panel">
      <h3>ğŸ”§ ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™”</h3>
      <button id="buyUpgradeBtn" onclick="buyUpgrade()">ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™” (+1) - <span id="upgradeCost">10</span> ì—ë„ˆì§€</button>
    </div>
    <div class="panel">
      <h3>â˜€ï¸ íƒœì–‘ê´‘ ë°œì „ê¸°</h3>
      <button id="buyGeneratorBtn" onclick="buyGenerator()">íƒœì–‘ê´‘ ë°œì „ê¸° (+1/s) - <span id="generatorCost">50</span> ì—ë„ˆì§€</button>
      <div>ë³´ìœ : <span id="generators">0</span></div>
    </div>
    <div class="panel">
      <h3>ğŸŒ í•µìœµí•© ë°œì „ì†Œ</h3>
      <button id="buyFusionPlantBtn" onclick="buyFusionPlant()">í•µìœµí•© ë°œì „ì†Œ (+10/s) - <span id="fusionCost">500</span> ì—ë„ˆì§€</button>
      <div>ë³´ìœ : <span id="fusionPlants">0</span></div>
    </div>
    <div class="panel">
      <h3>ğŸŒ€ ë‹¤ì´ìŠ¨ êµ¬ì²´</h3>
      <button id="buyDysonSphereBtn" onclick="buyDysonSphere()">ë‹¤ì´ìŠ¨ êµ¬ì²´ (+250/s) - <span id="dysonCost">20000</span> ì—ë„ˆì§€</button>
      <div>ë³´ìœ : <span id="dysonSpheres">0</span></div>
    </div>
    <div class="panel">
      <h3>ğŸ•³ï¸ ë¸”ë™í™€ ì—ë„ˆì§€</h3>
      <button id="buyBlackholeBtn" onclick="buyBlackhole()">ë¸”ë™í™€ ì—ë„ˆì§€ (+5000/s) - <span id="blackholeCost">750000</span> ì—ë„ˆì§€</button>
      <div>ë³´ìœ : <span id="blackholes">0</span></div>
    </div>
    <div class="panel">
      <h3>ğŸ’¥ ë¹…ë±…</h3>
      <button id="buyBigBangBtn" onclick="buyBigBang()">ë¹…ë±… (+100000/s) - <span id="bigbangCost">5000000</span> ì—ë„ˆì§€</button>
      <div>ë³´ìœ : <span id="bigbangs">0</span></div>
    </div>
    <div class="panel" id="terraformPanel">
      <h3>ğŸŒ í…Œë¼í¬ë°</h3>
      <button id="terraformPlanetBtn" onclick="terraformPlanet()">í…Œë¼í¬ë° (10000000 ì—ë„ˆì§€ í•„ìš”)</button>
    </div>
    <div class="panel" id="achievementsPanel" style="display:none;">
      <h3>ğŸ† ì—…ì </h3>
      <div id="achievements"></div>
      <button onclick="hideAchievements()">ë‹«ê¸°</button>
    </div>
    <button id="restartButton" onclick="restartGame()" style="display: none;">ê²Œì„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    <button id="retryButton" onclick="retryTimeAttack()" style="display: none;">íƒ€ì„ì–´íƒ ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
  </div>
  <script>
    // â˜…â˜…â˜… ìš°ì£¼/ì€í•˜ìˆ˜ 2.5D ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ â˜…â˜…â˜…
    const canvas = document.getElementById('starCanvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    function resizeCanvas() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resizeCanvas);

    const STAR_COUNT = 160;
    const NEBULA_COUNT = 3;

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }

    const stars = [];
    for (let i = 0; i < STAR_COUNT; i++) {
      stars.push({
        x: random(0, width),
        y: random(0, height),
        radius: random(0.5, 2.5),
        alpha: random(0.5, 1),
        speed: random(0.1, 0.6)
      });
    }

const nebulas = [];
for (let i = 0; i < NEBULA_COUNT; i++) {
  let angle = random(0, Math.PI * 2);
  let speed = random(0.02, 0.06);
  nebulas.push({
    x: random(width * 0.2, width * 0.8),
    y: random(height * 0.2, height * 0.8),
    radius: random(140, 350),
    color: `rgba(${random(120,180)},${random(100,180)},${random(190,255)},0.11)`,
    vx: Math.cos(angle) * speed,
    vy: Math.sin(angle) * speed
  });
}

function updateNebulas() {
  for (const n of nebulas) {
    n.x += n.vx;
    n.y += n.vy;
    if (n.x < -n.radius) n.x = width + n.radius;
    if (n.x > width + n.radius) n.x = -n.radius;
    if (n.y < -n.radius) n.y = height + n.radius;
    if (n.y > height + n.radius) n.y = -n.radius;
  }
}


    function drawBackground() {
      const grad = ctx.createLinearGradient(0, 0, 0, height);
      grad.addColorStop(0, "#0a0523");
      grad.addColorStop(0.6, "#191c38");
      grad.addColorStop(1, "#32284f");
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, width, height);
    }

    function drawStars() {
      for (const s of stars) {
        ctx.save();
        ctx.globalAlpha = s.alpha;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.shadowColor = "#c8e5ff";
        ctx.shadowBlur = 7;
        ctx.fill();
        ctx.restore();
      }
    }

    function drawNebulas() {
      for (const n of nebulas) {
        ctx.save();
        ctx.globalAlpha = 1;
        const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.radius);
        grad.addColorStop(0, "rgba(190, 210, 255, 0.21)");
        grad.addColorStop(0.2, n.color);
        grad.addColorStop(1, "rgba(50,50,80,0.04)");
        ctx.beginPath();
        ctx.arc(n.x, n.y, n.radius, 0, 2 * Math.PI);
        ctx.fillStyle = grad;
        ctx.fill();
        ctx.restore();
      }
    }

    function updateStars() {
      for (const s of stars) {
        s.y += s.speed;
        if (s.y > height) {
          s.y = 0;
          s.x = random(0, width);
          s.radius = random(0.5, 2.5);
          s.alpha = random(0.4, 1);
        }
      }
    }

    function animate() {
  drawBackground();
  updateNebulas();
  drawNebulas();
  drawStars();
  updateStars();
  requestAnimationFrame(animate);
}
   resizeCanvas();
    animate();
   // â˜…â˜…â˜… ê²Œì„ ë³€ìˆ˜/ëª¨ë“œ ë³€ìˆ˜ â˜…â˜…â˜…
  let gameEnded = false;
  let energy = 0, clickPower = 1, upgradeCost = 10;
  let generators = 0, generatorCost = 50;
  let fusionPlants = 0, fusionCost = 500;
  let dysonSpheres = 0, dysonCost = 20000;
  let blackholes = 0, blackholeCost = 750000;
  let bigbangs = 0, bigbangCost = 5000000;
  let inTimeAttack = false; // íƒ€ì„ì–´íƒ ëª¨ë“œ ì—¬ë¶€
  let inLimitedLandMode = false;
  let timeLeft = 1500; // 25ë¶„(ì´ˆ ë‹¨ìœ„)
  let timer = null;

  // â˜…â˜…â˜… ì—…ì  ì‹œìŠ¤í…œ â˜…â˜…â˜…
  const achievements = {
    firstClick: { name: "ì²œë¦¬ ê¸¸ë„ í•œ ê±¸ìŒ", condition: () => energy >= 1, unlocked: false },
    solarCollector: { name: "íƒœì–‘ê´‘ ìˆ˜ì§‘ê°€", condition: () => generators >= 10, unlocked: false },
    fusionMaster: { name: "í•µìœµí•© ë§ˆìŠ¤í„°", condition: () => fusionPlants >= 5, unlocked: false },
    dysonOwner: { name: "2í˜• ë¬¸ëª…", condition: () => dysonSpheres >= 1, unlocked: false },
    blackholeBoss: { name: "ë¸”ë™í™€ í™œìš©ê°€", condition: () => blackholes >= 1, unlocked: false },
    bigbangBreaker: { name: "ë¹…ë±…ì˜ ì—ë„ˆì§€", condition: () => bigbangs >= 1, unlocked: false },
    terraformer: { name: "í…Œë¼í¬ë° ì„±ê³µ!", condition: () => gameEnded, unlocked: false },
    sun: { name: "íƒœì–‘", condition: () => fusionPlants >= 10, unlocked: false }
  };

  // â˜…â˜…â˜… UI ì „í™˜ í•¨ìˆ˜ë“¤ (ê²¹ì¹¨ ì™„ë²½ ë°©ì§€!) â˜…â˜…â˜…
 function hideAllMenus() {
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('challengeMenu').style.display = 'none';
  document.getElementById('timeAttackMenu').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'none';
  document.getElementById('noticePanel').style.display = 'none';
  document.getElementById('landModeMenu').style.display = 'none';
}

  function showChallengeMenu() {
    hideAllMenus();
    document.getElementById('challengeMenu').style.display = 'block';
    document.getElementById('landModeMenu').style.display = 'none';
  }
 function backToMainMenu() {
  hideAllMenus();
  document.getElementById('pauseButton').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'none';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('achievementsPanel').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';
  if (inTimeAttack) {
    inTimeAttack = false;
    clearInterval(timer);
    timer = null;
    prev = null;
    timeAttackPaused = false;
  }
  inLimitedLandMode = false;
}
  function showTimeAttackMenu() {
    hideAllMenus();
    document.getElementById('timeAttackMenu').style.display = 'block';
    if (localStorage.getItem('ta_energy')) {
      document.getElementById('continueTimeAttackBtn').style.display = 'inline-block';
    } else {
      document.getElementById('continueTimeAttackBtn').style.display = 'none';
    }
  }
function showLandModeMenu() {
  hideAllMenus();
  document.getElementById('landModeMenu').style.display = 'block';
  if (localStorage.getItem('land_energy')) {
    document.getElementById('continueLandModeBtn').style.display = 'inline-block';
  } else {
    document.getElementById('continueLandModeBtn').style.display = 'none';
  }
}
  function showGameScreen() {
    hideAllMenus();
    document.getElementById('gameScreen').style.display = 'block';
  }

  // â˜…â˜…â˜… íƒ€ì„ì–´íƒ ëª¨ë“œ ì‹œì‘/ì´ì–´í•˜ê¸° â˜…â˜…â˜…
 function startTimeAttackGame() {
  inTimeAttack = true;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  dysonSpheres = 0; dysonCost = 20000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;
  timeLeft = 1500;
  showGameScreen();
  document.getElementById('timerBox').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';
  startTimeAttackTimer();
  updateDisplay();
  document.getElementById('pauseButton').style.display = 'inline-block';
  document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
}
function continueTimeAttackGame() {
  inTimeAttack = true;
  gameEnded = false;
  loadTimeAttack();
  showGameScreen();
  document.getElementById('timerBox').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none'; // â˜…ì¶”ê°€
  startTimeAttackTimer();
  updateDisplay();
  document.getElementById('pauseButton').style.display = 'inline-block';
  document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
}
function startLimitedLandGame() {
  inTimeAttack = false;
  inLimitedLandMode = true;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  dysonSpheres = 0; dysonCost = 20000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;
  showGameScreen();
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'block';
}
function continueLimitedLandGame() {
  inTimeAttack = false;
  inLimitedLandMode = true;
  gameEnded = false;
  loadLimitedLandGame();
  showGameScreen();
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'block';
}
 function continueTimeAttackGame() {
    inTimeAttack = true;
    gameEnded = false;
    loadTimeAttack();
    showGameScreen();
    document.getElementById('timerBox').style.display = 'block';
    document.getElementById('retryButton').style.display = 'none';
    startTimeAttackTimer();
    updateDisplay();
  }
  function retryTimeAttack() {
    startTimeAttackGame();
  }
  function endTimeAttack(success) {
    clearInterval(timer);
    document.getElementById('timerBox').style.display = 'block';
    document.getElementById('pauseButton').style.display = 'none';
    if (success) {
      document.getElementById('timerBox').textContent = "ğŸ‰ í´ë¦¬ì–´! í…Œë¼í¬ë° ì„±ê³µ!";
      setTimeout(() => { alert("ğŸ‰ í´ë¦¬ì–´! íƒ€ì„ì–´íƒ ì„±ê³µ!"); }, 200);
    } else {
      document.getElementById('timerBox').textContent = "â° ì‹¤íŒ¨! ì‹œê°„ì´ ì´ˆê³¼ëìŠµë‹ˆë‹¤.";
      setTimeout(() => { alert("â° ì‹¤íŒ¨! ì‹œê°„ì´ ì´ˆê³¼ëìŠµë‹ˆë‹¤."); }, 200);
      document.getElementById('retryButton').style.display = 'inline-block';
    }
    gameEnded = true;
    removeTimeAttackSave();
  }

  let prev = null;
  function startTimeAttackTimer() {
  prev = Date.now(); // â˜… ìƒˆë¡œ ì‹œì‘í•  ë•Œë„ prev ì´ˆê¸°í™”
  if (timer) clearInterval(timer);
  timer = setInterval(() => {
    if (gameEnded) return;
    if (isPaused()) return;
    let now = Date.now();
    let dt = (now - prev) / 1000;
    prev = now;
    timeLeft -= dt;
    if (timeLeft < 0) timeLeft = 0;
    updateTimerDisplay();
    if (timeLeft === 0) endTimeAttack(false);
  }, 10);
  updateTimerDisplay();
}
function updateTimerDisplay() {
    if (!inTimeAttack) {
      document.getElementById('timerBox').style.display = 'none';
      return;
    }
    let t = Math.max(0, timeLeft);
    let min = Math.floor(t / 60);
    let sec = Math.floor(t % 60);
    let ms = Math.floor((t - Math.floor(t)) * 100);
    let txt =
      (min < 10 ? '0' + min : min) + ':' +
      (sec < 10 ? '0' + sec : sec) + '.' +
      (ms < 10 ? '0' + ms : ms);
    document.getElementById('timerBox').textContent = txt;
  }
  function saveTimeAttack() {
    localStorage.setItem('ta_energy', energy);
    localStorage.setItem('ta_clickPower', clickPower);
    localStorage.setItem('ta_upgradeCost', upgradeCost);
    localStorage.setItem('ta_generators', generators);
    localStorage.setItem('ta_generatorCost', generatorCost);
    localStorage.setItem('ta_fusionPlants', fusionPlants);
    localStorage.setItem('ta_fusionCost', fusionCost);
    localStorage.setItem('ta_dysonSpheres', dysonSpheres);
    localStorage.setItem('ta_dysonCost', dysonCost);
    localStorage.setItem('ta_blackholes', blackholes);
    localStorage.setItem('ta_blackholeCost', blackholeCost);
    localStorage.setItem('ta_bigbangs', bigbangs);
    localStorage.setItem('ta_bigbangCost', bigbangCost);
    localStorage.setItem('ta_timeLeft', timeLeft);
  }
  function loadTimeAttack() {
    energy = parseInt(localStorage.getItem('ta_energy')) || 0;
    clickPower = parseInt(localStorage.getItem('ta_clickPower')) || 1;
    upgradeCost = parseInt(localStorage.getItem('ta_upgradeCost')) || 10;
    generators = parseInt(localStorage.getItem('ta_generators')) || 0;
    generatorCost = parseInt(localStorage.getItem('ta_generatorCost')) || 50;
    fusionPlants = parseInt(localStorage.getItem('ta_fusionPlants')) || 0;
    fusionCost = parseInt(localStorage.getItem('ta_fusionCost')) || 500;
    dysonSpheres = parseInt(localStorage.getItem('ta_dysonSpheres')) || 0;
    dysonCost = parseInt(localStorage.getItem('ta_dysonCost')) || 20000;
    blackholes = parseInt(localStorage.getItem('ta_blackholes')) || 0;
    blackholeCost = parseInt(localStorage.getItem('ta_blackholeCost')) || 750000;
    bigbangs = parseInt(localStorage.getItem('ta_bigbangs')) || 0;
    bigbangCost = parseInt(localStorage.getItem('ta_bigbangCost')) || 5000000;
    timeLeft = parseFloat(localStorage.getItem('ta_timeLeft')) || 1500;
  }
  function removeTimeAttackSave() {
    [
      'ta_energy','ta_clickPower','ta_upgradeCost',
      'ta_generators','ta_generatorCost',
      'ta_fusionPlants','ta_fusionCost',
      'ta_dysonSpheres','ta_dysonCost',
      'ta_blackholes','ta_blackholeCost',
      'ta_bigbangs','ta_bigbangCost',
      'ta_timeLeft'
    ].forEach(key => localStorage.removeItem(key));
  }
function saveLimitedLandGame() {
  localStorage.setItem('land_energy', energy);
  localStorage.setItem('land_clickPower', clickPower);
  localStorage.setItem('land_upgradeCost', upgradeCost);
  localStorage.setItem('land_generators', generators);
  localStorage.setItem('land_generatorCost', generatorCost);
  localStorage.setItem('land_fusionPlants', fusionPlants);
  localStorage.setItem('land_fusionCost', fusionCost);
  localStorage.setItem('land_dysonSpheres', dysonSpheres);
  localStorage.setItem('land_dysonCost', dysonCost);
  localStorage.setItem('land_blackholes', blackholes);
  localStorage.setItem('land_blackholeCost', blackholeCost);
  localStorage.setItem('land_bigbangs', bigbangs);
  localStorage.setItem('land_bigbangCost', bigbangCost);
}
function loadLimitedLandGame() {
  energy = parseInt(localStorage.getItem('land_energy')) || 0;
  clickPower = parseInt(localStorage.getItem('land_clickPower')) || 1;
  upgradeCost = parseInt(localStorage.getItem('land_upgradeCost')) || 10;
  generators = parseInt(localStorage.getItem('land_generators')) || 0;
  generatorCost = parseInt(localStorage.getItem('land_generatorCost')) || 50;
  fusionPlants = parseInt(localStorage.getItem('land_fusionPlants')) || 0;
  fusionCost = parseInt(localStorage.getItem('land_fusionCost')) || 500;
  dysonSpheres = parseInt(localStorage.getItem('land_dysonSpheres')) || 0;
  dysonCost = parseInt(localStorage.getItem('land_dysonCost')) || 20000;
  blackholes = parseInt(localStorage.getItem('land_blackholes')) || 0;
  blackholeCost = parseInt(localStorage.getItem('land_blackholeCost')) || 750000;
  bigbangs = parseInt(localStorage.getItem('land_bigbangs')) || 0;
  bigbangCost = parseInt(localStorage.getItem('land_bigbangCost')) || 5000000;
}
function removeLimitedLandSave() {
  [
    'land_energy','land_clickPower','land_upgradeCost',
    'land_generators','land_generatorCost',
    'land_fusionPlants','land_fusionCost',
    'land_dysonSpheres','land_dysonCost',
    'land_blackholes','land_blackholeCost',
    'land_bigbangs','land_bigbangCost'
  ].forEach(key => localStorage.removeItem(key));
}

  // â˜…â˜…â˜… í•µì‹¬ ê²Œì„ í•¨ìˆ˜ë“¤ (ì—…ê·¸ë ˆì´ë“œ, ë°œì „ì†Œ êµ¬ë§¤, UI ê°±ì‹  ë“±) â˜…â˜…â˜…
  function gainEnergy() {
    document.getElementById('clickSound').play();
    energy += clickPower;
    updateDisplay();
  }
  function buyUpgrade() {
    if (energy >= upgradeCost) {
      energy -= upgradeCost;
      clickPower++;
      upgradeCost = Math.floor(upgradeCost * 1.1);
      updateDisplay();
    }
  }
function buyGenerator() {
  if (inLimitedLandMode && generators >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” íƒœì–‘ê´‘ ë°œì „ê¸°ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= generatorCost) {
    energy -= generatorCost;
    generators++;
    generatorCost = Math.floor(generatorCost * 1.1);
    updateDisplay();
  }
}
function buyFusionPlant() {
  if (inLimitedLandMode && fusionPlants >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” í•µìœµí•© ë°œì „ì†Œë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= fusionCost) {
    energy -= fusionCost;
    fusionPlants++;
    fusionCost = Math.floor(fusionCost * 1.1);
    updateDisplay();
  }
}
function buyDysonSphere() {
  if (inLimitedLandMode && dysonSpheres >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë‹¤ì´ìŠ¨ êµ¬ì²´ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= dysonCost) {
    energy -= dysonCost;
    dysonSpheres++;
    dysonCost = Math.floor(dysonCost * 1.1);
    updateDisplay();
  }
}
 function buyBlackhole() {
  if (inLimitedLandMode && blackholes >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë¸”ë™í™€ ì—ë„ˆì§€ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= blackholeCost) {
    energy -= blackholeCost;
    blackholes++;
    blackholeCost = Math.floor(blackholeCost * 1.1);
    updateDisplay();
  }
}
 function buyBigBang() {
  if (inLimitedLandMode && bigbangs >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë¹…ë±…ì„ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= bigbangCost) {
    energy -= bigbangCost;
    bigbangs++;
    bigbangCost = Math.floor(bigbangCost * 1.1);
    updateDisplay();
  }
}
 function updateDisplay() {
  checkAchievements();
  if (gameEnded) return;
  document.getElementById('energy').textContent = `ì—ë„ˆì§€: ${formatNumber(energy)}`;
  document.getElementById('clickPower').textContent = `í´ë¦­ë‹¹ ì—ë„ˆì§€: ${formatNumber(clickPower)}`;
  document.getElementById('upgradeCost').textContent = formatNumber(upgradeCost);
  document.getElementById('generators').textContent = formatNumber(generators);
  document.getElementById('generatorCost').textContent = formatNumber(generatorCost);
  document.getElementById('fusionCost').textContent = formatNumber(fusionCost);
  document.getElementById('fusionPlants').textContent = formatNumber(fusionPlants);
  document.getElementById('dysonCost').textContent = formatNumber(dysonCost);
  document.getElementById('dysonSpheres').textContent = formatNumber(dysonSpheres);
  document.getElementById('blackholeCost').textContent = formatNumber(blackholeCost);
  document.getElementById('blackholes').textContent = formatNumber(blackholes);
  document.getElementById('bigbangCost').textContent = formatNumber(bigbangCost);
  document.getElementById('bigbangs').textContent = formatNumber(bigbangs);
  document.getElementById('productionRate').textContent = `ì´ˆë‹¹ ìƒì‚°ëŸ‰: ${formatNumber(generators + fusionPlants * 10 + dysonSpheres * 250 + blackholes * 5000 + bigbangs * 100000)}`;

document.getElementById('buyUpgradeBtn').innerHTML =
    `ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™” (+${formatNumber(1)}) - <span id="upgradeCost">${formatNumber(upgradeCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyGeneratorBtn').innerHTML =
    `íƒœì–‘ê´‘ ë°œì „ê¸° (+${formatNumber(1)}/s) - <span id="generatorCost">${formatNumber(generatorCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyFusionPlantBtn').innerHTML =
    `í•µìœµí•© ë°œì „ì†Œ (+${formatNumber(10)}/s) - <span id="fusionCost">${formatNumber(fusionCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyDysonSphereBtn').innerHTML =
    `ë‹¤ì´ìŠ¨ êµ¬ì²´ (+${formatNumber(250)}/s) - <span id="dysonCost">${formatNumber(dysonCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyBlackholeBtn').innerHTML =
    `ë¸”ë™í™€ ì—ë„ˆì§€ (+${formatNumber(5000)}/s) - <span id="blackholeCost">${formatNumber(blackholeCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyBigBangBtn').innerHTML =
    `ë¹…ë±… (+${formatNumber(100000)}/s) - <span id="bigbangCost">${formatNumber(bigbangCost)}</span> ì—ë„ˆì§€`;

  document.querySelector('#terraformPanel button').textContent =
    `í…Œë¼í¬ë° (${formatNumber(10000000)} ì—ë„ˆì§€ í•„ìš”)`;
}
  function checkAchievements() {
  for (let key in achievements) {
    const a = achievements[key];
    if (!a.unlocked && a.condition()) {
      a.unlocked = true;
      alert(`ğŸ‰ ì—…ì  ë‹¬ì„±: ${a.name}`);
      prev = Date.now();
    }
  }
  renderAchievements();
}
  function renderAchievements() {
    const panel = document.getElementById('achievements');
    panel.innerHTML = '';
    for (let key in achievements) {
      if (achievements[key].unlocked) {
        const div = document.createElement('div');
        div.textContent = achievements[key].name;
        div.style.color = 'gold';
        div.style.margin = '5px';
        panel.appendChild(div);
      }
    }
  }
  function terraformPlanet() {
    if (energy >= 10000000) {
      if (inTimeAttack) {
        endTimeAttack(true);
      } else {
        gameEnded = true;
        alert("ğŸ‰ í…Œë¼í¬ë° ì„±ê³µ! ê²Œì„ì´ ëë‚¬ìŠµë‹ˆë‹¤!");
        document.getElementById('restartButton').style.display = 'inline-block';
      }
    } else {
      alert(`ì—ë„ˆì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (${formatNumber(10000000)} í•„ìš”)`);
    }
  }
  function restartGame() {
    energy = 0;
    clickPower = 1;
    upgradeCost = 10;
    generators = 0;
    generatorCost = 50;
    fusionPlants = 0;
    fusionCost = 500;
    dysonSpheres = 0;
    dysonCost = 20000;
    blackholes = 0;
    blackholeCost = 750000;
    bigbangs = 0;
    bigbangCost = 5000000;
    gameEnded = false;
    document.getElementById('restartButton').style.display = 'none';
    updateDisplay();
  }

  // â˜…â˜…â˜… ì„¸ì´ë¸Œ/ë¡œë“œ í•¨ìˆ˜ â˜…â˜…â˜…
  function saveGame() {
    if (inTimeAttack) {
      saveTimeAttack();
      alert('íƒ€ì„ì–´íƒ ì €ì¥ ì™„ë£Œ!');
      return;
    }
    localStorage.setItem('energy', energy);
    localStorage.setItem('clickPower', clickPower);
    localStorage.setItem('upgradeCost', upgradeCost);
    localStorage.setItem('generators', generators);
    localStorage.setItem('generatorCost', generatorCost);
    localStorage.setItem('fusionPlants', fusionPlants);
    localStorage.setItem('fusionCost', fusionCost);
    localStorage.setItem('dysonSpheres', dysonSpheres);
    localStorage.setItem('dysonCost', dysonCost);
    localStorage.setItem('blackholes', blackholes);
    localStorage.setItem('blackholeCost', blackholeCost);
    localStorage.setItem('bigbangs', bigbangs);
    localStorage.setItem('bigbangCost', bigbangCost);
    localStorage.setItem('achievements', JSON.stringify(Object.fromEntries(Object.entries(achievements).map(([k, v]) => [k, v.unlocked]))));
  }
  function loadGame() {
    energy = parseInt(localStorage.getItem('energy')) || 0;
    clickPower = parseInt(localStorage.getItem('clickPower')) || 1;
    upgradeCost = parseInt(localStorage.getItem('upgradeCost')) || 10;
    generators = parseInt(localStorage.getItem('generators')) || 0;
    generatorCost = parseInt(localStorage.getItem('generatorCost')) || 50;
    fusionPlants = parseInt(localStorage.getItem('fusionPlants')) || 0;
    fusionCost = parseInt(localStorage.getItem('fusionCost')) || 500;
    dysonSpheres = parseInt(localStorage.getItem('dysonSpheres')) || 0;
    dysonCost = parseInt(localStorage.getItem('dysonCost')) || 20000;
    blackholes = parseInt(localStorage.getItem('blackholes')) || 0;
    blackholeCost = parseInt(localStorage.getItem('blackholeCost')) || 750000;
    bigbangs = parseInt(localStorage.getItem('bigbangs')) || 0;
    bigbangCost = parseInt(localStorage.getItem('bigbangCost')) || 5000000;
  }
  function loadAchievements() {
    const saved = JSON.parse(localStorage.getItem('achievements') || '{}');
    for (let key in saved) {
      if (achievements[key]) achievements[key].unlocked = saved[key];
    }
    renderAchievements();
   }

  // â˜…â˜…â˜… ë©”ì¸/ê¸°ì¡´ í•¨ìˆ˜ë“¤ê³¼ ì—°ë™: â˜…â˜…â˜…
  function startNewGame() {
  localStorage.clear();
  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  inTimeAttack = false;
  restartGame();
  loadAchievements();
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'none'; // â˜…ì¶”ê°€
}
 function continueGame() {
  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  inTimeAttack = false;
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  loadAchievements();
  loadGame();
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'none'; // â˜…ì¶”ê°€
}

  // â˜…â˜…â˜… ê²Œì„ ìë™ ì§„í–‰(ìƒì‚°, ì„¸ì´ë¸Œ) â˜…â˜…â˜…
 setInterval(() => {
  if (gameEnded) return;
  if (inTimeAttack) {
    if (isPaused()) return;
    energy += generators + fusionPlants * 10 + dysonSpheres * 250 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveTimeAttack();
  } else if (inLimitedLandMode) {
    energy += generators + fusionPlants * 10 + dysonSpheres * 250 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveLimitedLandGame();
  } else {
    energy += generators + fusionPlants * 10 + dysonSpheres * 250 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveGame();
  }
}, 1000);
function showNotice() {
  hideAllMenus();
  document.getElementById('noticePanel').style.display = 'block';
}
function closeNotice() {
  document.getElementById('noticePanel').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
}
  // â˜…â˜…â˜… íƒ€ì„ì–´íƒ/ì¼ë°˜ëª¨ë“œ ë²„íŠ¼ í‘œì‹œ ì²˜ë¦¬ â˜…â˜…â˜…
function togglePause() {
  if (inTimeAttack) {
    timeAttackPaused = !timeAttackPaused;
    if (timeAttackPaused) {
      document.getElementById('timerBox').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€ (ë²„íŠ¼ìœ¼ë¡œ ì¬ê°œ)';
      document.getElementById('pauseButton').textContent = 'â–¶ï¸ ì¬ê°œ';
      setGameButtonsDisabled(true); // ëª¨ë‘ ë¹„í™œì„±í™”, pauseButtonë§Œ í™œì„±
    } else {
      prev = Date.now();
      updateTimerDisplay();
      document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
      setGameButtonsDisabled(false); // ëª¨ë‘ í™œì„±í™”
    }
  }
}
window.onload = () => {
  if (localStorage.getItem('energy')) {
    continueGame();
  } else {
    document.getElementById('mainMenu').style.display = 'block';
  }
  if (localStorage.getItem('ta_energy')) {
    document.getElementById('continueTimeAttackBtn').style.display = 'inline-block';
  }
  document.getElementById('restartButton').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  document.body.addEventListener('click', () => {
    const bgm = document.getElementById('bgm');
    if (bgm.paused) bgm.play();
  }, { once: true });
};
function showAchievements() {
  document.getElementById('achievementsPanel').style.display = 'block';
}

function hideAchievements() {
  document.getElementById('achievementsPanel').style.display = 'none';
  prev = Date.now(); // ì—…ì ì°½ ë‹«ì„ ë•Œ prev ê°±ì‹ 
}
window.addEventListener('keydown', (e) => {
  if (inTimeAttack && document.getElementById('gameScreen').style.display === 'block') {
    if (e.code === 'Space') {
      timeAttackPaused = !timeAttackPaused;
      if (timeAttackPaused) {
        document.getElementById('timerBox').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì¬ê°œ)';
      } else {
        prev = Date.now(); // â˜… ì¼ì‹œì •ì§€ í•´ì œ ì‹œ prevë¥¼ í˜„ì¬ ì‹œì ìœ¼ë¡œ!
        updateTimerDisplay();
      }
    }
  }
});
</script>
</body>
</html>
