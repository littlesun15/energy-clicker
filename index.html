<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Energy Clicker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to bottom, #0b0c2a, #1a1e3f, #292f5c);
      color: #e0f7fa;
      margin: 0;
      padding: 20px;
      text-align: center;
      overflow-x: hidden;
    }
    canvas#starCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    #timerBox {
      position: fixed;
      top: 20px;
      right: 40px;
      background: rgba(0,0,0,0.4);
      color: #ffd600;
      font-size: 2em;
      font-weight: bold;
      border-radius: 10px;
      padding: 10px 25px;
      z-index: 100;
      letter-spacing: 1px;
      display: none;
      text-shadow: 0 0 8px #ffecb3;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #ffffff;
      text-shadow: 0 0 10px #00bcd4;
    }
    #energy, #productionRate, #clickPower {
      font-size: 1.3em;
      font-weight: bold;
      color: #aefeff;
      text-shadow: 0 0 5px #26c6da;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 8px;
      border-radius: 12px;
      background: linear-gradient(to right, #0f9b8e, #00bcd4);
      color: #ffffff;
      border: 1px solid #00acc1;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
      background: linear-gradient(to right, #00acc1, #26c6da);
    }
    .panel {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 20px;
      margin: 20px auto;
      width: 90%;
      max-width: 350px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }
    .panel h3 {
      font-size: 1.3em;
      margin-bottom: 10px;
      color: #ffffff;
      text-shadow: 0 0 5px #80deea;
    }
    #restartButton, #retryButton {
      margin-top: 20px;
      background: #ff1744;
      border: 1px solid #f44336;
    }
    #restartButton:hover, #retryButton:hover {
      background: #ff5252;
      box-shadow: 0 0 10px rgba(255, 82, 82, 0.6);
    }
    /* ë„ì „ ëª¨ë“œ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    #challengeMenu, #timeAttackMenu {
      display: none;
    }
    #challengeList button {
      margin: 20px;
      font-size: 1.2em;
      padding: 15px 35px;
      border-radius: 18px;
    }
  </style>
</head>
<body>
  <canvas id="starCanvas"></canvas>

  <!-- ë©”ì¸ ë©”ë‰´ -->
  <div id="mainMenu">
    <h1>âš¡ Energy Clicker</h1>
    <div id="mainDesc" style="margin: 15px 0 20px 0; font-size:1.1em; color:#b2ebf2; text-shadow:0 0 5px #26c6da;">
      í´ë¦­í•´ì„œ ì„ìœ ë¥¼ ì‹œì¶”í•˜ê³ ,<br>
      ë‹¤ì–‘í•œ ë°œì „ì†Œë¥¼ ê±´ì„¤í•´ ë‹¤ë¥¸ í–‰ì„±ì„ í…Œë¼í¬ë° í•˜ì„¸ìš”!<br><br>
      ì œì‘ì: ì •ì´ì¤€
    </div>
    <button onclick="startNewGame()">ğŸ® ìƒˆ ê²Œì„ ì‹œì‘</button>
    <button id="continueButton" onclick="continueGame()" style="display: none;">ğŸ’¾ ì €ì¥ëœ ê²Œì„ ì´ì–´í•˜ê¸°</button>
    <button onclick="showChallengeMenu()">ğŸš© ë„ì „</button>
    <button onclick="showNotice()">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
    <button onclick="showSettings()">âš™ï¸ ì„¤ì •</button>
  </div>

<div id="noticePanel" style="display:none;">
  <h1>ğŸ“¢ ê³µì§€ì‚¬í•­</h1>
  <div id="noticeContent" style="margin:20px; color:#e0f7fa; font-size:1.15em;">
    - íŒ¨ì¹˜ë…¸íŠ¸: 1.4.1v í–‰ì„± í¬ê¸° ë³€ê²½<br>
    -1.4.5v ì„¤ì • ë©”ë‰´ ì¶”ê°€(ë°°ê²½,ì–¸ì–´,ë¦¬ì…‹)(ì–¸ì–´ëŠ” ì¼ë¶€ë§Œ ë°”ë€œ(ì„¤ì •íƒ­,ì—…ì  ë“±))<br>
    -1.5.0v ì—…ì  ë³´ìƒ ì¶”ê°€, ìµœëŒ€ ê°€ëŠ¥í•œ í´ë¦­ íšŸìˆ˜ëŠ” ì´ˆë‹¹ 25ë¡œ ë³€ê²½(ì˜¤í† í´ë¦­ ë§‰ê¸°ìš©),ìƒˆë¡œìš´ ëª¨ë“œ ì¶”ê°€<br>
    -1.5.5v ìƒˆ ì—…ì  ì¶”ê°€, ìƒˆë¡œìš´ ëª¨ë“œ ì¶”ê°€<br><br>
    -í˜„ì¬ ë²„ì „: 1.5.5v
  </div>
  <button onclick="closeNotice()">ë‹«ê¸°</button>
</div>

 <div id="settingsPanel" style="display:none;">
  <h1 id="settingsTitle">âš™ï¸ ì„¤ì •</h1>
  <label>
    <input type="checkbox" id="bgToggle" checked>
    <span id="bgLabel">ë°°ê²½ í‘œì‹œ</span>
  </label>
  <br><br>
  <label>
    <span id="langLabel">ì–¸ì–´</span>:
    <select id="langSelect">
      <option value="ko">í•œêµ­ì–´</option>
      <option value="en">English</option>
    </select>
  </label>
  <br><br>
  <button onclick="resetGameWithConfirm()" id="resetBtn">ê²Œì„ ë¦¬ì…‹</button>
  <br><br>
  <button onclick="closeSettings()" id="closeSettingsBtn">ë‹«ê¸°</button>
</div>

  <!-- ë„ì „ ëª¨ë“œ ë©”ë‰´ -->
  <div id="challengeMenu">
    <h1>ğŸš© ë„ì „ ëª¨ë“œ ì„ íƒ</h1>
    <div id="challengeList">
      <button onclick="showTimeAttackMenu()">â±ï¸ íƒ€ì„ì–´íƒ ëª¨ë“œ</button>
      <button onclick="showLandModeMenu()">ğŸŒ ë•… ë¶€ì¡± ëª¨ë“œ</button>
      <button onclick="showHardcoreMenu()">ğŸ’€ í•˜ë“œì½”ì–´ ëª¨ë“œ</button>
      <button onclick="startInfiniteMode()">â™¾ï¸ ë¬´í•œ ëª¨ë“œ</button>
      <button onclick="showSecretModePassword()">ğŸ•µï¸â€â™‚ï¸ ë¹„ë°€ëª¨ë“œ</button>
    </div>
    <button onclick="backToMainMenu()">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
  </div>
<div id="hardcoreMenu" style="display:none;">
  <h1>ğŸ’€ í•˜ë“œì½”ì–´ ëª¨ë“œ</h1>
  <div style="margin:10px 0 30px 0; font-size:1.05em;">
    ë°œì „ì†Œ ê°€ê²© ìƒìŠ¹ë¥  1.25ë°°!<br>
    ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œ ì œí•œ!<br>
    í…Œë¼í¬ë°ì— 1,500ë§Œ ì—ë„ˆì§€ í•„ìš”!<br>
    ê°€ëŠ¥í•œê°€ìš”?
  </div>
  <button onclick="startHardcoreGame()">ğŸ’€ ìƒˆ í•˜ë“œì½”ì–´ ì‹œì‘</button>
  <button onclick="backToMainMenu()">â† ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
</div>

<div id="landModeMenu" style="display:none;">
  <h1>ğŸŒ ë•… ë¶€ì¡± ëª¨ë“œ</h1>
  <div style="margin:10px 0 30px 0; font-size:1.05em;">
    ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œ ì œí•œ!<br>ì–¸ì œë“  ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥
  </div>
  <button onclick="startLimitedLandGame()">ğŸŒ± ìƒˆ ë•… ë¶€ì¡± ëª¨ë“œ ì‹œì‘</button>
  <button id="continueLandModeBtn" onclick="continueLimitedLandGame()" style="display:none;">ğŸ’¾ ì €ì¥ëœ ë•…ë¶€ì¡± ì´ì–´í•˜ê¸°</button>
  <button onclick="showChallengeMenu()">â† ë„ì „ ëª¨ë“œ ì„ íƒìœ¼ë¡œ</button>
</div>

  <!-- íƒ€ì„ì–´íƒ ëª¨ë“œ ì‹œì‘ ë©”ë‰´ -->
  <div id="timeAttackMenu">
    <h1>â±ï¸ íƒ€ì„ì–´íƒ ëª¨ë“œ</h1>
    <div style="margin:10px 0 30px 0; font-size:1.05em;">25ë¶„ ì•ˆì— í…Œë¼í¬ë°ì„ ì„±ê³µí•˜ë©´ í´ë¦¬ì–´!<br>ì§„í–‰ ì¤‘ ì–¸ì œë“  ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥</div>
    <button onclick="startTimeAttackGame()">â° ìƒˆ íƒ€ì„ì–´íƒ ì‹œì‘</button>
    <button id="continueTimeAttackBtn" onclick="continueTimeAttackGame()" style="display:none;">ğŸ’¾ ì €ì¥ëœ íƒ€ì„ì–´íƒ ì´ì–´í•˜ê¸°</button>
    <button onclick="showChallengeMenu()">â† ë„ì „ ëª¨ë“œ ì„ íƒìœ¼ë¡œ</button>
  </div>

  <!-- ë‚¨ì€ ì‹œê°„ ë°•ìŠ¤ -->
  <div id="timerBox"></div>
</div>

  <!-- ê²Œì„ í™”ë©´ (ê¸°ì¡´) -->
  <div id="gameScreen" style="display: none;">
    <audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f23b7d3083.mp3" preload="auto"></audio>
    <audio id="bgm" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_96e0576b8b.mp3" loop preload="auto"></audio>
 <div id="landLimitNotice" style="display:none; color:#ffcc80; font-weight:bold; margin-bottom:10px;">
  ğŸŒ <b>ë•… ë¶€ì¡± ëª¨ë“œ</b>: ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê±´ì„¤ ê°€ëŠ¥!
</div>
   <h1>âš¡ Energy Clicker</h1>
    <div id="energy">ì—ë„ˆì§€: 0</div>
    <div id="productionRate">ì´ˆë‹¹ ìƒì‚°ëŸ‰: 0</div>
    <div id="clickPower">í´ë¦­ë‹¹ ì—ë„ˆì§€: 1</div>
<button id="saveGameBtn" onclick="saveGame()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
<button id="pauseButton" onclick="togglePause()" style="display:none;">â¸ï¸ ì¼ì‹œì •ì§€</button>
<button id="gainEnergyBtn" onclick="gainEnergy()">âš¡ ì„ìœ  ì‹œì¶”í•˜ê¸°</button>
<button onclick="backToMainMenu()">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
<button id="showAchievementsBtn" onclick="showAchievements()">ğŸ† ì—…ì  ë³´ê¸°</button>
<div class="panel">
  <h3>ğŸ”§ ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™”</h3>
  <button id="buyUpgradeBtn" onclick="buyUpgrade()">ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™” (+1) - <span id="upgradeCost">10</span> ì—ë„ˆì§€</button>
</div>
<div class="panel">
  <h3>â˜€ï¸ íƒœì–‘ê´‘ ë°œì „ê¸°</h3>
  <button id="buyGeneratorBtn" onclick="buyGenerator()">íƒœì–‘ê´‘ ë°œì „ê¸° (+1/s) - <span id="generatorCost">50</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="generators">0</span></div>
</div>
<div class="panel">
  <h3>ğŸŒ í•µìœµí•© ë°œì „ì†Œ</h3>
  <button id="buyFusionPlantBtn" onclick="buyFusionPlant()">í•µìœµí•© ë°œì „ì†Œ (+10/s) - <span id="fusionCost">500</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="fusionPlants">0</span></div>
</div>
<div class="panel">
  <h3>âš›ï¸ ë°˜ë¬¼ì§ˆ ë°œì „ì†Œ</h3>
  <button id="buyAntimatterPlantBtn" onclick="buyAntimatterPlant()">ë°˜ë¬¼ì§ˆ ë°œì „ì†Œ (+250/s) - <span id="antimatterCost">20,000</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="antimatterPlants">0</span></div>
</div>
<div class="panel">
  <h3>ğŸŒ€ ë‹¤ì´ìŠ¨ êµ¬ì²´</h3>
  <button id="buyDysonSphereBtn" onclick="buyDysonSphere()">ë‹¤ì´ìŠ¨ êµ¬ì²´ (+1000/s) - <span id="dysonCost">100000</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="dysonSpheres">0</span></div>
</div>
<div class="panel">
  <h3>ğŸ•³ï¸ ë¸”ë™í™€ ì—ë„ˆì§€</h3>
  <button id="buyBlackholeBtn" onclick="buyBlackhole()">ë¸”ë™í™€ ì—ë„ˆì§€ (+5000/s) - <span id="blackholeCost">750000</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="blackholes">0</span></div>
</div>
<div class="panel">
  <h3>ğŸ’¥ ë¹…ë±…</h3>
  <button id="buyBigBangBtn" onclick="buyBigBang()">ë¹…ë±… (+100000/s) - <span id="bigbangCost">5000000</span> ì—ë„ˆì§€</button>
  <div>ë³´ìœ : <span id="bigbangs">0</span></div>
</div>
<div class="panel" id="terraformPanel">
  <h3>ğŸŒ í…Œë¼í¬ë°</h3>
  <button id="terraformPlanetBtn" onclick="terraformPlanet()">í…Œë¼í¬ë° (10000000 ì—ë„ˆì§€ í•„ìš”)</button>
</div>
    <div class="panel" id="achievementsPanel" style="display:none;">
  <h3>ğŸ† ì—…ì </h3>
  <div id="achievements"></div>
  <button onclick="hideAchievements()">ë‹«ê¸°</button>
</div>
    <button id="restartButton" onclick="restartGame()" style="display: none;">ê²Œì„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    <button id="retryButton" onclick="retryTimeAttack()" style="display: none;">íƒ€ì„ì–´íƒ ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
  </div>
  
  <script>
 const LANG = {
  ko: {
    settings: "âš™ï¸ ì„¤ì •",
    bgLabel: "ë°°ê²½ í‘œì‹œ",
    langLabel: "ì–¸ì–´",
    reset: "ê²Œì„ ë¦¬ì…‹",
    close: "ë‹«ê¸°",
    resetConfirm: "ì •ë§ë¡œ ë¦¬ì…‹ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
    ach_firstClick: "ì²œë¦¬ ê¸¸ë„ í•œ ê±¸ìŒ",
    ach_solarCollector: "íƒœì–‘ê´‘ ìˆ˜ì§‘ê°€",
    ach_fusionMaster: "í•µìœµí•© ë§ˆìŠ¤í„°",
    ach_dysonOwner: "2í˜• ë¬¸ëª…",
    ach_blackholeBoss: "ë¸”ë™í™€ í™œìš©ê°€",
    ach_bigbangBreaker: "ë¹…ë±…ì˜ ì—ë„ˆì§€",
    ach_terraformer: "í…Œë¼í¬ë° ì„±ê³µ!",
    ach_sun: "íƒœì–‘",
    ach_dangerousMatter: "ìœ„í—˜í•œ ë¬¼ì§ˆ"
  },
  en: {
    settings: "âš™ï¸ Settings",
    bgLabel: "Show Background",
    langLabel: "Language",
    reset: "Reset Game",
    close: "Close",
    resetConfirm: "Are you sure you want to reset the game?",
    ach_firstClick: "A Journey of a Thousand Miles",
    ach_solarCollector: "Solar Collector",
    ach_fusionMaster: "Fusion Master",
    ach_dysonOwner: "Type II Civilization",
    ach_blackholeBoss: "Black Hole User",
    ach_bigbangBreaker: "Energy of Big Bang",
    ach_terraformer: "Terraforming Success!",
    ach_sun: "Sun",
    ach_dangerousMatter: "Dangerous Matter"
  }
};
function getT(key) {
  const lang = localStorage.getItem('lang') || 'ko';
  return LANG[lang][key] || key;
}

// â˜…â˜…â˜… [1] ì „ì—­ ë³€ìˆ˜/í•¨ìˆ˜ ì¶”ê°€ (ë§¨ ìœ„) â˜…â˜…â˜…
let timeAttackPaused = false;

const plantOrder = [
  { key: 'bigbangs', name: 'ë¹…ë±…' },
  { key: 'blackholes', name: 'ë¸”ë™í™€ ì—ë„ˆì§€' },
  { key: 'dysonSpheres', name: 'ë‹¤ì´ìŠ¨ êµ¬ì²´' },
  { key: 'antimatterPlants', name: 'ë°˜ë¬¼ì§ˆ ë°œì „ì†Œ' },
  { key: 'fusionPlants', name: 'í•µìœµí•© ë°œì „ì†Œ' },
  { key: 'generators', name: 'íƒœì–‘ê´‘ ë°œì „ê¸°' }
];

function formatNumber(n) {
  return n.toLocaleString('en-US');
}

function updateBackground() {
  let bgStyle = "";
  let stage = "";

  if (energy <= 10000) {
    bgStyle = "linear-gradient(to bottom, #786554, #ad9876, #cfc2a0)";
    stage = "barren";
  } else if (energy <= 100000) {
    bgStyle = "linear-gradient(to bottom, #72694b 70%, #88bce7 100%)";
    stage = "water";
  } else if (energy <= 500000) {
    bgStyle = "linear-gradient(to bottom, #6e9954 35%, #4fc3f7 65%, #a0eaff 100%)";
    stage = "lake";
  } else if (energy <= 7500000) {
    bgStyle = "linear-gradient(to bottom, #81c784 65%, #b3e89e 100%)";
    stage = "plant";
  } else if (energy <= 10000000) {
    bgStyle = "linear-gradient(to bottom, #a5d6a7 60%, #b2dfdb 90%, #fffde7 100%)";
    stage = "animal";
  } else {
    bgStyle = "linear-gradient(to bottom, #a7ffeb 50%, #64b5f6 100%, #fff59d 100%)";
    stage = "perfect";
  }
  document.body.style.background = bgStyle;
}

function isPaused() {
  return inTimeAttack && (document.getElementById('achievementsPanel').style.display !== 'none' || timeAttackPaused);
}
let gameEnded = false;
let energy = 0, clickPower = 1, upgradeCost = 10;
let generators = 0, generatorCost = 50;
let fusionPlants = 0, fusionCost = 500;
let antimatterPlants = 0, antimatterCost = 20000;
let dysonSpheres = 0, dysonCost = 100000;
let blackholes = 0, blackholeCost = 750000;
let bigbangs = 0, bigbangCost = 5000000;
let inTimeAttack = false;
let inLimitedLandMode = false;
let timeLeft = 1500;
let inHardcoreMode = false;
let timer = null;
let clickTimestamps = [];
let inInfiniteMode = false;

// â˜…â˜…â˜… ë³„ + ë””í…Œì¼ í–‰ì„± ì „ì²´ ì½”ë“œ â˜…â˜…â˜…
const canvas = document.getElementById('starCanvas');
const ctx = canvas.getContext('2d');
let stars = [];
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', () => { resizeCanvas(); initStars(); });
resizeCanvas();

function initStars() {
  stars = [];
  for (let i = 0; i < 120; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      radius: Math.random() * 2 + 1,
      speed: Math.random() * 0.45 + 0.12
    });
  }
}
initStars();

// ê¸°ë³¸ ìƒ‰ìƒ (ì—ë„ˆì§€ ë‹¨ê³„ë³„)
function getPlanetColor(energy) {
  if (energy <= 10000)    return "#bba073";   // í™©ëŸ‰
  else if (energy <= 100000)  return "#7ec8e3"; // ë¬¼
  else if (energy <= 500000)  return "#b4e1fa"; // í˜¸ìˆ˜
  else if (energy <= 7500000) return "#b3e89e"; // ì‹ìƒ
  else if (energy <= 10000000) return "#fffde7"; // ë™ë¬¼
  else return "#fff59d";      // í…Œë¼í¬ë° ì™„
}

// ê·¸ë¼ë°ì´ì…˜ì„ í†µí•œ êµ¬í˜• ì…ì²´ íš¨ê³¼
function drawSphericalGradient(cx, cy, r, baseColor) {
  // ì™¸ê³½ì´ ì–´ë‘ìš´ êµ¬í˜• ê·¸ë¼ë°ì´ì…˜
  let grad = ctx.createRadialGradient(
    cx - r*0.3, cy - r*0.35, r*0.3,   // ì¤‘ì‹¬(ë¹›ìª½)
    cx, cy, r                        // ì™¸ê³½
  );
  grad.addColorStop(0, "#fff");
  grad.addColorStop(0.14, baseColor);
  grad.addColorStop(0.8, shadeColor(baseColor, -35));
  grad.addColorStop(1, "#000");
  ctx.beginPath();
  ctx.arc(cx, cy, r, Math.PI, 2 * Math.PI);
  ctx.fillStyle = grad;
  ctx.shadowColor = baseColor;
  ctx.shadowBlur = 45;
  ctx.fill();
  ctx.shadowBlur = 0;
}

// ìƒ‰ ì–´ë‘¡ê²Œ/ë°ê²Œ
function shadeColor(color, percent) {
  let R = parseInt(color.substring(1,3),16);
  let G = parseInt(color.substring(3,5),16);
  let B = parseInt(color.substring(5,7),16);
  R = Math.min(255, Math.max(0, R + percent));
  G = Math.min(255, Math.max(0, G + percent));
  B = Math.min(255, Math.max(0, B + percent));
  return "#" + (R.toString(16).padStart(2,'0')) + (G.toString(16).padStart(2,'0')) + (B.toString(16).padStart(2,'0'));
}

// ì–¼ë£©ë¬´ëŠ¬
function drawBlotches(cx, cy, r, count, color, alpha=0.14) {
  ctx.save();
  ctx.globalAlpha = alpha;
  for (let i = 0; i < count; i++) {
    let ang = Math.random() * Math.PI;
    let rr = r * (0.5 + Math.random() * 0.21);
    let dx = Math.cos(ang) * rr * 0.92;
    let dy = Math.sin(ang) * rr * 0.65;
    ctx.beginPath();
    ctx.ellipse(cx+dx, cy+dy, r*0.09*Math.random(), r*0.06, Math.random()*Math.PI, 0, 2*Math.PI);
    ctx.fillStyle = color;
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  ctx.restore();
}

// ë¬¼
function drawLakes(cx, cy, r) {
  ctx.save();
  ctx.globalAlpha = 0.21;
  for (let i=0; i<2; i++) {
    ctx.beginPath();
    ctx.ellipse(cx + r*0.25*i, cy - r*0.12 - r*0.11*i, r*0.28, r*0.065, 0.17*i, 0, 2*Math.PI);
    ctx.fillStyle = "#3ca6ef";
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  ctx.restore();
}

// ì‹ìƒ
function drawGreenPatches(cx, cy, r, energy) {
  let alpha = 0.12 + 0.13*(Math.min(energy, 10000000)/10000000);
  ctx.save();
  ctx.globalAlpha = alpha;
  for (let i=0; i<3; i++) {
    ctx.beginPath();
    ctx.arc(cx - r*0.38 + r*0.21*i, cy - r*0.16 + r*0.09*i, r*0.11 - 0.01*i*r, 0, 2*Math.PI);
    ctx.fillStyle = "#44cf49";
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  ctx.restore();
}

function drawHighlight(cx, cy, r) {
  ctx.save();
  ctx.globalAlpha = 0.16;
  ctx.beginPath();
  ctx.arc(cx - r * 0.35, cy - r * 0.32, r * 0.18, 0, 2 * Math.PI);
  ctx.fillStyle = "#fff";
  ctx.shadowColor = "#fffde7";
  ctx.shadowBlur = 28;
  ctx.fill();
  ctx.shadowBlur = 0;
  ctx.globalAlpha = 1;
  ctx.restore();
}

// í•˜ì´ë¼ì´íŠ¸ ê´‘íƒ
function drawPlanet3D(energy) {
  const cx = canvas.width / 2;
  const cy = canvas.height * 1.12;
  const base = Math.min(canvas.width, canvas.height);
  const minR = 80;
  const maxR = 340;
  const r = Math.max(minR, Math.min(base * 0.36, maxR));
  drawSphericalGradient(cx, cy, r, getPlanetColor(energy));
  if (energy <= 10000) drawBlotches(cx, cy, r, 8, "#6b5b36", 0.22);
  if (energy > 9000 && energy <= 500000) drawLakes(cx, cy, r);
  if (energy > 10000 && energy <= 500000) drawBlotches(cx, cy, r, 5, "#447799", 0.13);
  if (energy > 500000) drawGreenPatches(cx, cy, r, energy);
  if (energy > 500000) drawBlotches(cx, cy, r, 3, "#295526", 0.19);
  drawHighlight(cx, cy, r);
}

function draw() {
  if (window._hideBG) {
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    return;
  }

  // ê¸°ì¡´ ë°°ê²½(ìš°ì£¼/í–‰ì„±)
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  // ë³„
  ctx.fillStyle = "#fff";
  for (let star of stars) {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fill();
  }
  // 3D í–‰ì„±
  drawPlanet3D(window.energy);
}

function updateStars() {
  for (let star of stars) {
    star.y += star.speed;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  }
}
function animate() {
  draw();
  updateStars();
  requestAnimationFrame(animate);
}
window.addEventListener('resize', initStars);
window.addEventListener('load', () => {
  initStars();
  animate();
});
function applyLanguage() {
  document.getElementById('settingsTitle').textContent = getT('settings');
  document.getElementById('bgLabel').textContent = getT('bgLabel');
  document.getElementById('langLabel').textContent = getT('langLabel');
  document.getElementById('resetBtn').textContent = getT('reset');
  document.getElementById('closeSettingsBtn').textContent = getT('close');
  renderAchievements();
}
  // â˜…â˜…â˜… ì—…ì  ì‹œìŠ¤í…œ â˜…â˜…â˜…
  const achievements = {
  firstClick: { 
    name: () => getT('ach_firstClick'), 
    condition: () => energy >= 1, 
    unlocked: false 
  }, // ì²œë¦¬ ê¸¸ë„ í•œ ê±¸ìŒ (ë³´ìƒ ì—†ìŒ)
  solarCollector: { 
    name: () => getT('ach_solarCollector'), 
    condition: () => generators >= 10, 
    unlocked: false, 
    reward: 10 
  }, // íƒœì–‘ê´‘ ìˆ˜ì§‘ê°€
  fusionMaster: { 
    name: () => getT('ach_fusionMaster'), 
    condition: () => fusionPlants >= 5, 
    unlocked: false, 
    reward: 20 
  }, // í•µìœµí•© ë§ˆìŠ¤í„°
  dysonOwner: { 
    name: () => getT('ach_dysonOwner'), 
    condition: () => dysonSpheres >= 1, 
    unlocked: false,
    reward: 500
  }, // 2í˜• ë¬¸ëª…
  blackholeBoss: { 
    name: () => getT('ach_blackholeBoss'), 
    condition: () => blackholes >= 1, 
    unlocked: false,
    reward: 7500
  }, // ë¸”ë™í™€ í™œìš©ê°€
  bigbangBreaker: { 
    name: () => getT('ach_bigbangBreaker'), 
    condition: () => bigbangs >= 1, 
    unlocked: false,
    reward: 125000
  }, // ë¹…ë±…ì˜ ì—ë„ˆì§€
  terraformer: { 
    name: () => getT('ach_terraformer'), 
    condition: () => gameEnded, 
    unlocked: false
    // reward ì—†ìŒ!
  }, // í…Œë¼í¬ë° ì„±ê³µ!
  sun: { 
    name: () => getT('ach_sun'), 
    condition: () => fusionPlants >= 10, 
    unlocked: false, 
    reward: 30 
  }, // íƒœì–‘
 dangerousMatter: {
    name: () => getT('ach_dangerousMatter'),
    condition: () => antimatterPlants >= 1,
    unlocked: false,
    reward: 150
  } // ìœ„í—˜í•œ ë¬¼ì§ˆ
};

  // â˜…â˜…â˜… UI ì „í™˜ í•¨ìˆ˜ë“¤ (ê²¹ì¹¨ ì™„ë²½ ë°©ì§€!) â˜…â˜…â˜…
 function hideAllMenus() {
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('challengeMenu').style.display = 'none';
  document.getElementById('timeAttackMenu').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'none';
  document.getElementById('noticePanel').style.display = 'none';
  document.getElementById('landModeMenu').style.display = 'none';
}

  function showChallengeMenu() {
    hideAllMenus();
    document.getElementById('challengeMenu').style.display = 'block';
    document.getElementById('landModeMenu').style.display = 'none';
  }
function showTimeAttackMenu() {
  hideAllMenus();
  document.getElementById('timeAttackMenu').style.display = 'block';
  if (localStorage.getItem('ta_energy')) {
    document.getElementById('continueTimeAttackBtn').style.display = 'inline-block';
  } else {
    document.getElementById('continueTimeAttackBtn').style.display = 'none';
  }
}
 function backToMainMenu() {
  hideAllMenus();
  document.getElementById('pauseButton').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'none';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('achievementsPanel').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';
  inHardcoreMode = false;
  if (inTimeAttack) {
    inTimeAttack = false;
    clearInterval(timer);
    timer = null;
    prev = null;
    timeAttackPaused = false;
  }
  inLimitedLandMode = false;
  if (localStorage.getItem('energy')) {
    document.getElementById('continueButton').style.display = 'inline-block';
  } else {
    document.getElementById('continueButton').style.display = 'none';
  }
}
function showLandModeMenu() {
  hideAllMenus();
  document.getElementById('landModeMenu').style.display = 'block';
  if (localStorage.getItem('land_energy')) {
    document.getElementById('continueLandModeBtn').style.display = 'inline-block';
  } else {
    document.getElementById('continueLandModeBtn').style.display = 'none';
  }
}
 function showGameScreen() {
  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('landLimitNotice').style.display = 'none';
}
function showHardcoreMenu() {
  hideAllMenus();
  document.getElementById('hardcoreMenu').style.display = 'block';
}
function startHardcoreGame() {
  inHardcoreMode = true;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  antimatterPlants = 0; antimatterCost = 20000;
  dysonSpheres = 0; dysonCost = 100000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;

  document.getElementById('hardcoreMenu').style.display = 'none';

  showGameScreen();
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';

  document.getElementById('landLimitNotice').innerHTML =
    'ğŸ’€ <b>í•˜ë“œì½”ì–´ ëª¨ë“œ</b>: ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê±´ì„¤ ê°€ëŠ¥!, í…Œë¼í¬ë° ì—ë„ˆì§€ 15,000,000!, ë°œì „ì†Œ ê°€ê²© ìƒìŠ¹ë¥  1.25ë°°!';

  document.getElementById('landLimitNotice').style.display = 'block';
  updateDisplay();
}

  // â˜…â˜…â˜… íƒ€ì„ì–´íƒ ëª¨ë“œ ì‹œì‘/ì´ì–´í•˜ê¸° â˜…â˜…â˜…
 function startTimeAttackGame() {
  inTimeAttack = true;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  antimatterPlants = 0; antimatterCost = 20000;
  dysonSpheres = 0; dysonCost = 100000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;
  timeLeft = 1500;
  showGameScreen();
  document.getElementById('timerBox').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';
  startTimeAttackTimer();
  updateDisplay();
  document.getElementById('pauseButton').style.display = 'inline-block';
  document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
}
function continueTimeAttackGame() {
  inTimeAttack = true;
  gameEnded = false;
  loadTimeAttack();
  showGameScreen();
  document.getElementById('timerBox').style.display = 'block';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';
  startTimeAttackTimer();
  updateDisplay();
  document.getElementById('pauseButton').style.display = 'inline-block';
  document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
}
function startLimitedLandGame() {
  inTimeAttack = false;
  inLimitedLandMode = true;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  antimatterPlants = 0; antimatterCost = 20000;
  dysonSpheres = 0; dysonCost = 100000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;
  showGameScreen();
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';

  document.getElementById('landLimitNotice').innerHTML =
    'ğŸŒ <b>ë•… ë¶€ì¡± ëª¨ë“œ</b>: ê° ë°œì „ì†Œ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê±´ì„¤ ê°€ëŠ¥!';

  document.getElementById('landLimitNotice').style.display = 'block';
  updateDisplay();
}
function continueLimitedLandGame() {
  inTimeAttack = false;
  inLimitedLandMode = true;
  gameEnded = false;
  loadLimitedLandGame();
  showGameScreen();
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'block';
}
 function continueTimeAttackGame() {
    inTimeAttack = true;
    gameEnded = false;
    loadTimeAttack();
    showGameScreen();
    document.getElementById('timerBox').style.display = 'block';
    document.getElementById('retryButton').style.display = 'none';
    startTimeAttackTimer();
    updateDisplay();
  }
  function retryTimeAttack() {
    startTimeAttackGame();
  }
  function endTimeAttack(success) {
  clearInterval(timer);
  document.getElementById('timerBox').style.display = 'block';
  document.getElementById('pauseButton').style.display = 'none';
  if (success) {
    let t = Math.max(0, timeLeft);
    let min = Math.floor(t / 60);
    let sec = Math.floor(t % 60);
    let ms = Math.floor((t - Math.floor(t)) * 100);
    let msg = `ğŸ‰ í´ë¦¬ì–´! í…Œë¼í¬ë° ì„±ê³µ!\në‚¨ì€ ì‹œê°„: ${min < 10 ? '0' + min : min}:${sec < 10 ? '0' + sec : sec}.${ms < 10 ? '0' + ms : ms}`;
    document.getElementById('timerBox').textContent = "ğŸ‰ í´ë¦¬ì–´! í…Œë¼í¬ë° ì„±ê³µ!";
    setTimeout(() => { alert(msg); }, 200);
  } else {
    document.getElementById('timerBox').textContent = "â° ì‹¤íŒ¨! ì‹œê°„ì´ ì´ˆê³¼ëìŠµë‹ˆë‹¤.";
    setTimeout(() => { alert("â° ì‹¤íŒ¨! ì‹œê°„ì´ ì´ˆê³¼ëìŠµë‹ˆë‹¤."); }, 200);
    document.getElementById('retryButton').style.display = 'inline-block';
  }
  gameEnded = true;
  removeTimeAttackSave();
}

  let prev = null;
  function startTimeAttackTimer() {
  prev = Date.now();
  if (timer) clearInterval(timer);
  timer = setInterval(() => {
    if (gameEnded) return;
    if (isPaused()) return;
    let now = Date.now();
    let dt = (now - prev) / 1000;
    prev = now;
    timeLeft -= dt;
    if (timeLeft < 0) timeLeft = 0;
    updateTimerDisplay();
    if (timeLeft === 0) endTimeAttack(false);
  }, 10);
  updateTimerDisplay();
}
function updateTimerDisplay() {
    if (!inTimeAttack) {
      document.getElementById('timerBox').style.display = 'none';
      return;
    }
    let t = Math.max(0, timeLeft);
    let min = Math.floor(t / 60);
    let sec = Math.floor(t % 60);
    let ms = Math.floor((t - Math.floor(t)) * 100);
    let txt =
      (min < 10 ? '0' + min : min) + ':' +
      (sec < 10 ? '0' + sec : sec) + '.' +
      (ms < 10 ? '0' + ms : ms);
    document.getElementById('timerBox').textContent = txt;
  }
  function saveTimeAttack() {
    localStorage.setItem('ta_energy', energy);
    localStorage.setItem('ta_clickPower', clickPower);
    localStorage.setItem('ta_upgradeCost', upgradeCost);
    localStorage.setItem('ta_generators', generators);
    localStorage.setItem('ta_generatorCost', generatorCost);
    localStorage.setItem('ta_fusionPlants', fusionPlants);
    localStorage.setItem('ta_fusionCost', fusionCost);
    localStorage.setItem('antimatterPlants', antimatterPlants);
    localStorage.setItem('antimatterCost', antimatterCost);
    localStorage.setItem('ta_dysonSpheres', dysonSpheres);
    localStorage.setItem('ta_dysonCost', dysonCost);
    localStorage.setItem('ta_blackholes', blackholes);
    localStorage.setItem('ta_blackholeCost', blackholeCost);
    localStorage.setItem('ta_bigbangs', bigbangs);
    localStorage.setItem('ta_bigbangCost', bigbangCost);
    localStorage.setItem('ta_timeLeft', timeLeft);
  }
  function loadTimeAttack() {
    energy = parseInt(localStorage.getItem('ta_energy')) || 0;
    clickPower = parseInt(localStorage.getItem('ta_clickPower')) || 1;
    upgradeCost = parseInt(localStorage.getItem('ta_upgradeCost')) || 10;
    generators = parseInt(localStorage.getItem('ta_generators')) || 0;
    generatorCost = parseInt(localStorage.getItem('ta_generatorCost')) || 50;
    fusionPlants = parseInt(localStorage.getItem('ta_fusionPlants')) || 0;
    fusionCost = parseInt(localStorage.getItem('ta_fusionCost')) || 500;
    antimatterPlants = parseInt(localStorage.getItem('antimatterPlants')) || 0;
    antimatterCost = parseInt(localStorage.getItem('antimatterCost')) || 20000;
    dysonSpheres = parseInt(localStorage.getItem('ta_dysonSpheres')) || 0;
    dysonCost = parseInt(localStorage.getItem('ta_dysonCost')) || 100000;
    blackholes = parseInt(localStorage.getItem('ta_blackholes')) || 0;
    blackholeCost = parseInt(localStorage.getItem('ta_blackholeCost')) || 750000;
    bigbangs = parseInt(localStorage.getItem('ta_bigbangs')) || 0;
    bigbangCost = parseInt(localStorage.getItem('ta_bigbangCost')) || 5000000;
    timeLeft = parseFloat(localStorage.getItem('ta_timeLeft')) || 1500;
  }
  function removeTimeAttackSave() {
    [
      'ta_energy','ta_clickPower','ta_upgradeCost',
      'ta_generators','ta_generatorCost',
      'ta_fusionPlants','ta_fusionCost',
      'ta_dysonSpheres','ta_dysonCost',
      'ta_blackholes','ta_blackholeCost',
      'ta_bigbangs','ta_bigbangCost',
      'ta_timeLeft'
    ].forEach(key => localStorage.removeItem(key));
  }
function saveLimitedLandGame() {
  localStorage.setItem('land_energy', energy);
  localStorage.setItem('land_clickPower', clickPower);
  localStorage.setItem('land_upgradeCost', upgradeCost);
  localStorage.setItem('land_generators', generators);
  localStorage.setItem('land_generatorCost', generatorCost);
  localStorage.setItem('land_fusionPlants', fusionPlants);
  localStorage.setItem('land_fusionCost', fusionCost);
  localStorage.setItem('land_antimatterPlants', antimatterPlants);
  localStorage.setItem('land_antimatterCost', antimatterCost);
  localStorage.setItem('land_dysonSpheres', dysonSpheres);
  localStorage.setItem('land_dysonCost', dysonCost);
  localStorage.setItem('land_blackholes', blackholes);
  localStorage.setItem('land_blackholeCost', blackholeCost);
  localStorage.setItem('land_bigbangs', bigbangs);
  localStorage.setItem('land_bigbangCost', bigbangCost);
}
function loadLimitedLandGame() {
  energy = parseInt(localStorage.getItem('land_energy')) || 0;
  clickPower = parseInt(localStorage.getItem('land_clickPower')) || 1;
  upgradeCost = parseInt(localStorage.getItem('land_upgradeCost')) || 10;
  generators = parseInt(localStorage.getItem('land_generators')) || 0;
  generatorCost = parseInt(localStorage.getItem('land_generatorCost')) || 50;
  fusionPlants = parseInt(localStorage.getItem('land_fusionPlants')) || 0;
  fusionCost = parseInt(localStorage.getItem('land_fusionCost')) || 500;
  antimatterPlants = parseInt(localStorage.getItem('land_antimatterPlants')) || 0;
  antimatterCost = parseInt(localStorage.getItem('land_antimatterCost')) || 20000;
  dysonSpheres = parseInt(localStorage.getItem('land_dysonSpheres')) || 0;
  dysonCost = parseInt(localStorage.getItem('land_dysonCost')) || 100000;
  blackholes = parseInt(localStorage.getItem('land_blackholes')) || 0;
  blackholeCost = parseInt(localStorage.getItem('land_blackholeCost')) || 750000;
  bigbangs = parseInt(localStorage.getItem('land_bigbangs')) || 0;
  bigbangCost = parseInt(localStorage.getItem('land_bigbangCost')) || 5000000;
}
function removeLimitedLandSave() {
  [
    'land_energy','land_clickPower','land_upgradeCost',
    'land_generators','land_generatorCost',
    'land_fusionPlants','land_fusionCost',
    'land_antimatterPlants','land_antimatterCost',
    'land_dysonSpheres','land_dysonCost',
    'land_blackholes','land_blackholeCost',
    'land_bigbangs','land_bigbangCost'
  ].forEach(key => localStorage.removeItem(key));
}

  // â˜…â˜…â˜… í•µì‹¬ ê²Œì„ í•¨ìˆ˜ë“¤ (ì—…ê·¸ë ˆì´ë“œ, ë°œì „ì†Œ êµ¬ë§¤, UI ê°±ì‹  ë“±) â˜…â˜…â˜…
 function gainEnergy() {
  const now = Date.now();
  // 1ì´ˆ ì´ë‚´ì˜ í´ë¦­ë§Œ ê¸°ë¡
  clickTimestamps = clickTimestamps.filter(t => now - t < 1000);

  if (clickTimestamps.length >= 25) {
    // í´ë¦­ ì œí•œ ì•Œë¦¼(í•„ìš” ì—†ìœ¼ë©´ ì£¼ì„ì²˜ë¦¬)
    // alert("ì´ˆë‹¹ 25íšŒê¹Œì§€ë§Œ í´ë¦­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
    return;
  }

  clickTimestamps.push(now);

  document.getElementById('clickSound').play();
  energy += clickPower;
  updateDisplay();
}
  function buyUpgrade() {
    if (energy >= upgradeCost) {
      energy -= upgradeCost;
      clickPower++;
      if (!inSecretMode) {
      upgradeCost = Math.floor(upgradeCost * (inHardcoreMode ? 1.25 : 1.1));
      }
      updateDisplay();
    }
  }
function buyGenerator() {
  if ((inLimitedLandMode || inHardcoreMode) && generators >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” íƒœì–‘ê´‘ ë°œì „ê¸°ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= generatorCost) {
    energy -= generatorCost;
    generators++;
    if (!inSecretMode) {
    generatorCost = Math.floor(generatorCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function buyFusionPlant() {
  if ((inLimitedLandMode || inHardcoreMode) && fusionPlants >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” í•µìœµí•© ë°œì „ì†Œë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= fusionCost) {
    energy -= fusionCost;
    fusionPlants++;
    if (!inSecretMode) {
    fusionCost = Math.floor(fusionCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function buyAntimatterPlant() {
  if ((inLimitedLandMode || inHardcoreMode) && antimatterPlants >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë°˜ë¬¼ì§ˆ ë°œì „ì†Œë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= antimatterCost) {
    energy -= antimatterCost;
    antimatterPlants++;
    if (!inSecretMode) {
    antimatterCost = Math.floor(antimatterCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function buyDysonSphere() {
  if ((inLimitedLandMode || inHardcoreMode) && dysonSpheres >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë‹¤ì´ìŠ¨ êµ¬ì²´ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= dysonCost) {
    energy -= dysonCost;
    dysonSpheres++;
    if (!inSecretMode) {
    dysonCost = Math.floor(dysonCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function buyBlackhole() {
  if ((inLimitedLandMode || inHardcoreMode) && blackholes >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë¸”ë™í™€ ì—ë„ˆì§€ë¥¼ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= blackholeCost) {
    energy -= blackholeCost;
    blackholes++;
    if (!inSecretMode) {
    blackholeCost = Math.floor(blackholeCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function buyBigBang() {
  if ((inLimitedLandMode || inHardcoreMode) && bigbangs >= 10) {
    alert("ì´ ëª¨ë“œì—ì„œëŠ” ë¹…ë±…ì„ 10ê°œ ì´ìƒ ê±´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
    return;
  }
  if (energy >= bigbangCost) {
    energy -= bigbangCost;
    bigbangs++;
    if (!inSecretMode) {
    bigbangCost = Math.floor(bigbangCost * (inHardcoreMode ? 1.25 : 1.1));
    }
    updateDisplay();
  }
}

function updateDisplay() {
  document.getElementById('energy').textContent = `ì—ë„ˆì§€: ${formatNumber(energy)}`;
  checkAchievements();
  if (gameEnded) return;
  document.getElementById('energy').textContent = `ì—ë„ˆì§€: ${formatNumber(energy)}`;
  document.getElementById('clickPower').textContent = `í´ë¦­ë‹¹ ì—ë„ˆì§€: ${formatNumber(clickPower)}`;
  document.getElementById('upgradeCost').textContent = formatNumber(upgradeCost);
  document.getElementById('generators').textContent = formatNumber(generators);
  document.getElementById('generatorCost').textContent = formatNumber(generatorCost);
  document.getElementById('fusionCost').textContent = formatNumber(fusionCost);
  document.getElementById('fusionPlants').textContent = formatNumber(fusionPlants);

  document.getElementById('antimatterCost').textContent = formatNumber(antimatterCost);
  document.getElementById('antimatterPlants').textContent = formatNumber(antimatterPlants);
  document.getElementById('buyAntimatterPlantBtn').innerHTML =
    `ë°˜ë¬¼ì§ˆ ë°œì „ì†Œ (+${formatNumber(250)}/s) - <span id="antimatterCost">${formatNumber(antimatterCost)}</span> ì—ë„ˆì§€`;

  document.getElementById('dysonCost').textContent = formatNumber(dysonCost);
  document.getElementById('dysonSpheres').textContent = formatNumber(dysonSpheres);
  document.getElementById('buyDysonSphereBtn').innerHTML =
  `ë‹¤ì´ìŠ¨ êµ¬ì²´ (+${formatNumber(1000)}/s) - <span id="dysonCost">${formatNumber(dysonCost)}</span> ì—ë„ˆì§€`;

  document.getElementById('blackholeCost').textContent = formatNumber(blackholeCost);
  document.getElementById('blackholes').textContent = formatNumber(blackholes);
  document.getElementById('bigbangCost').textContent = formatNumber(bigbangCost);
  document.getElementById('bigbangs').textContent = formatNumber(bigbangs);

  document.getElementById('productionRate').textContent =
    `ì´ˆë‹¹ ìƒì‚°ëŸ‰: ${formatNumber(
      generators +
      fusionPlants * 10 +
      antimatterPlants * 250 +
      dysonSpheres * 1000 +
      blackholes * 5000 +
      bigbangs * 100000
    )}`;

  document.getElementById('buyUpgradeBtn').innerHTML =
    `ì„ìœ  ì‹œì¶” ì¥ë¹„ ê°•í™” (+${formatNumber(1)}) - <span id="upgradeCost">${formatNumber(upgradeCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyGeneratorBtn').innerHTML =
    `íƒœì–‘ê´‘ ë°œì „ê¸° (+${formatNumber(1)}/s) - <span id="generatorCost">${formatNumber(generatorCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyFusionPlantBtn').innerHTML =
    `í•µìœµí•© ë°œì „ì†Œ (+${formatNumber(10)}/s) - <span id="fusionCost">${formatNumber(fusionCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyBlackholeBtn').innerHTML =
    `ë¸”ë™í™€ ì—ë„ˆì§€ (+${formatNumber(5000)}/s) - <span id="blackholeCost">${formatNumber(blackholeCost)}</span> ì—ë„ˆì§€`;
  document.getElementById('buyBigBangBtn').innerHTML =
    `ë¹…ë±… (+${formatNumber(100000)}/s) - <span id="bigbangCost">${formatNumber(bigbangCost)}</span> ì—ë„ˆì§€`;

  document.querySelector('#terraformPanel button').textContent =
  `í…Œë¼í¬ë° (${formatNumber(inHardcoreMode ? 15000000 : 10000000)} ì—ë„ˆì§€ í•„ìš”)`;

updateBackground();

if (inInfiniteMode) {
    document.getElementById('terraformPanel').style.display = 'none';
  } else {
    document.getElementById('terraformPanel').style.display = 'block';
  }
}
setInterval(() => {
  if (gameEnded) return;
  const r = Math.random();
  if (r < 0.04) { // 4% í™•ë¥ ë¡œ ì´ë²¤íŠ¸ ë°œìƒ
    if (Math.random() < 0.5) {
      triggerAsteroidEvent();
    } else {
      triggerExplosionEvent();
    }
  }
}, 60000);

function triggerAsteroidEvent() {
  for (const plant of plantOrder) {
    if (window[plant.key] > 0) {
      window[plant.key]--;
      alert(`â˜„ï¸ ì†Œí–‰ì„± ì¶©ëŒ! [${plant.name}] 1ê°œê°€ íŒŒê´´ëë‹¤!`);
      updateDisplay();
      return;
    }
  }
  // ì•„ë¬´ ë°œì „ì†Œë„ ì—†ì„ ë•ŒëŠ” ì•„ë¬´ ì¼ë„ ì—†ìŒ
}

 function triggerExplosionEvent() {
  const loss = Math.floor(Math.random() * (500000 - 50000 + 1)) + 50000;
  if (energy <= loss) {
    energy = 0;
    alert(`ğŸ’¥ ì—ë„ˆì§€ í­ë°œ! ëª¨ë“  ì—ë„ˆì§€ê°€ ì‚¬ë¼ì¡Œë‹¤!`);
  } else {
    energy -= loss;
    alert(`ğŸ’¥ ì—ë„ˆì§€ í­ë°œ! ì—ë„ˆì§€ê°€ ${formatNumber(loss)}ë§Œí¼ ì‚¬ë¼ì¡Œë‹¤!`);
  }
  updateDisplay();
}
 function checkAchievements() {
  for (let key in achievements) {
    const a = achievements[key];
    if (!a.unlocked && a.condition()) {
      a.unlocked = true;
      if (a.reward) clickPower += a.reward;
      alert(`ğŸ‰ ì—…ì  ë‹¬ì„±: ${a.name()}${a.reward ? ` (+${a.reward} í´ë¦­ë‹¹ ì—ë„ˆì§€)` : ""}`);
      prev = Date.now();
    }
  }
  renderAchievements();
}
  function renderAchievements() {
    const panel = document.getElementById('achievements');
    panel.innerHTML = '';
    for (let key in achievements) {
      if (achievements[key].unlocked) {
        const div = document.createElement('div');
        div.textContent = achievements[key].name();
        div.style.color = 'gold';
        div.style.margin = '5px';
        panel.appendChild(div);
      }
    }
  }
  function terraformPlanet() {
  let required = inHardcoreMode ? 15000000 : 10000000;
  if (energy >= required) {
    if (inTimeAttack) {
      endTimeAttack(true);
    } else {
      gameEnded = true;
      alert("ğŸ‰ í…Œë¼í¬ë° ì„±ê³µ! ê²Œì„ì´ ëë‚¬ìŠµë‹ˆë‹¤!");
      document.getElementById('restartButton').style.display = 'inline-block';
    }
  } else {
    alert(`ì—ë„ˆì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (${formatNumber(required)} í•„ìš”)`);
  }
}
  function restartGame() {
    energy = 0;
    clickPower = 1;
    upgradeCost = 10;
    generators = 0;
    generatorCost = 50;
    fusionPlants = 0;
    fusionCost = 500;
    antimatterPlants = 0;
    antimatterCost = 20000;
    dysonSpheres = 0;
    dysonCost = 100000;
    blackholes = 0;
    blackholeCost = 750000;
    bigbangs = 0;
    bigbangCost = 5000000;
    gameEnded = false;
    document.getElementById('restartButton').style.display = 'none';
    updateDisplay();
  }

  // â˜…â˜…â˜… ì„¸ì´ë¸Œ/ë¡œë“œ í•¨ìˆ˜ â˜…â˜…â˜…
  function saveGame() {
   localStorage.setItem('energy', energy);
   localStorage.setItem('clickPower', clickPower);
   localStorage.setItem('upgradeCost', upgradeCost);
    if (inTimeAttack) {
      saveTimeAttack();
      alert('íƒ€ì„ì–´íƒ ì €ì¥ ì™„ë£Œ!');
      return;
    }
    localStorage.setItem('energy', energy);
    localStorage.setItem('clickPower', clickPower);
    localStorage.setItem('upgradeCost', upgradeCost);
    localStorage.setItem('generators', generators);
    localStorage.setItem('generatorCost', generatorCost);
    localStorage.setItem('fusionPlants', fusionPlants);
    localStorage.setItem('fusionCost', fusionCost);
    localStorage.setItem('antimatterPlants', antimatterPlants);
    localStorage.setItem('antimatterCost', antimatterCost);
    localStorage.setItem('dysonSpheres', dysonSpheres);
    localStorage.setItem('dysonCost', dysonCost);
    localStorage.setItem('blackholes', blackholes);
    localStorage.setItem('blackholeCost', blackholeCost);
    localStorage.setItem('bigbangs', bigbangs);
    localStorage.setItem('bigbangCost', bigbangCost);
    localStorage.setItem('achievements', JSON.stringify(Object.fromEntries(Object.entries(achievements).map(([k, v]) => [k, v.unlocked]))));
  }
  function loadGame() {
    energy = parseInt(localStorage.getItem('energy')) || 0;
    clickPower = parseInt(localStorage.getItem('clickPower')) || 1;
    upgradeCost = parseInt(localStorage.getItem('upgradeCost')) || 10;
    generators = parseInt(localStorage.getItem('generators')) || 0;
    generatorCost = parseInt(localStorage.getItem('generatorCost')) || 50;
    fusionPlants = parseInt(localStorage.getItem('fusionPlants')) || 0;
    fusionCost = parseInt(localStorage.getItem('fusionCost')) || 500;
    antimatterPlants = parseInt(localStorage.getItem('antimatterPlants')) || 0;
    antimatterCost = parseInt(localStorage.getItem('antimatterCost')) || 20000;
    dysonSpheres = parseInt(localStorage.getItem('dysonSpheres')) || 0;
    dysonCost = parseInt(localStorage.getItem('dysonCost')) || 100000;
    blackholes = parseInt(localStorage.getItem('blackholes')) || 0;
    blackholeCost = parseInt(localStorage.getItem('blackholeCost')) || 750000;
    bigbangs = parseInt(localStorage.getItem('bigbangs')) || 0;
    bigbangCost = parseInt(localStorage.getItem('bigbangCost')) || 5000000;
alert('loadGame called! energy=' + energy);
console.log(
    'loadGame() called!',
    'energy:', localStorage.getItem('energy'),
    'clickPower:', localStorage.getItem('clickPower')
  );
  }
  function loadAchievements() {
    const saved = JSON.parse(localStorage.getItem('achievements') || '{}');
    for (let key in saved) {
      if (achievements[key]) achievements[key].unlocked = saved[key];
    }
    renderAchievements();
   }
function saveInfiniteGame() {
  localStorage.setItem('inf_energy', energy);
  localStorage.setItem('inf_clickPower', clickPower);
  localStorage.setItem('inf_upgradeCost', upgradeCost);
  localStorage.setItem('inf_generators', generators);
  localStorage.setItem('inf_generatorCost', generatorCost);
  localStorage.setItem('inf_fusionPlants', fusionPlants);
  localStorage.setItem('inf_fusionCost', fusionCost);
  localStorage.setItem('inf_antimatterPlants', antimatterPlants);
  localStorage.setItem('inf_antimatterCost', antimatterCost);
  localStorage.setItem('inf_dysonSpheres', dysonSpheres);
  localStorage.setItem('inf_dysonCost', dysonCost);
  localStorage.setItem('inf_blackholes', blackholes);
  localStorage.setItem('inf_blackholeCost', blackholeCost);
  localStorage.setItem('inf_bigbangs', bigbangs);
  localStorage.setItem('inf_bigbangCost', bigbangCost);
  localStorage.setItem('inf_achievements', JSON.stringify(Object.fromEntries(Object.entries(achievements).map(([k, v]) => [k, v.unlocked]))));
}

function loadInfiniteGame() {
  energy = parseInt(localStorage.getItem('inf_energy')) || 0;
  clickPower = parseInt(localStorage.getItem('inf_clickPower')) || 1;
  upgradeCost = parseInt(localStorage.getItem('inf_upgradeCost')) || 10;
  generators = parseInt(localStorage.getItem('inf_generators')) || 0;
  generatorCost = parseInt(localStorage.getItem('inf_generatorCost')) || 50;
  fusionPlants = parseInt(localStorage.getItem('inf_fusionPlants')) || 0;
  fusionCost = parseInt(localStorage.getItem('inf_fusionCost')) || 500;
  antimatterPlants = parseInt(localStorage.getItem('inf_antimatterPlants')) || 0;
  antimatterCost = parseInt(localStorage.getItem('inf_antimatterCost')) || 20000;
  dysonSpheres = parseInt(localStorage.getItem('inf_dysonSpheres')) || 0;
  dysonCost = parseInt(localStorage.getItem('inf_dysonCost')) || 100000;
  blackholes = parseInt(localStorage.getItem('inf_blackholes')) || 0;
  blackholeCost = parseInt(localStorage.getItem('inf_blackholeCost')) || 750000;
  bigbangs = parseInt(localStorage.getItem('inf_bigbangs')) || 0;
  bigbangCost = parseInt(localStorage.getItem('inf_bigbangCost')) || 5000000;

  // ì—…ì  ë¶ˆëŸ¬ì˜¤ê¸°
  const saved = JSON.parse(localStorage.getItem('inf_achievements') || '{}');
  for (let key in saved) {
    if (achievements[key]) achievements[key].unlocked = saved[key];
  }
  renderAchievements();
}

  // â˜…â˜…â˜… ë©”ì¸/ê¸°ì¡´ í•¨ìˆ˜ë“¤ê³¼ ì—°ë™: â˜…â˜…â˜…
  function startNewGame() {
  localStorage.clear();
  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  inTimeAttack = false;
  restartGame();
  loadAchievements();
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'none';
}
 function continueGame() {
  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  inTimeAttack = false;
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  loadAchievements();
  loadGame();
  updateDisplay();
  document.getElementById('landLimitNotice').style.display = 'none';
}
function startInfiniteMode() {
  inInfiniteMode = true;
  inTimeAttack = false;
  inLimitedLandMode = false;
  inHardcoreMode = false;
  gameEnded = false;
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  antimatterPlants = 0; antimatterCost = 20000;
  dysonSpheres = 0; dysonCost = 100000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;

  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';

  updateDisplay();
}

  // â˜…â˜…â˜… ê²Œì„ ìë™ ì§„í–‰(ìƒì‚°, ì„¸ì´ë¸Œ) â˜…â˜…â˜…
 setInterval(() => {
  if (gameEnded) return;
  if (inTimeAttack) {
    if (isPaused()) return;
    energy += generators + fusionPlants * 10 + antimatterPlants * 250 + dysonSpheres * 1000 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveTimeAttack();
  } else if (inLimitedLandMode) {
    energy += generators + fusionPlants * 10 + antimatterPlants * 250 + dysonSpheres * 1000 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveLimitedLandGame();
    saveInfiniteGame();
  } else {
    energy += generators + fusionPlants * 10 + antimatterPlants * 250 + dysonSpheres * 1000 + blackholes * 5000 + bigbangs * 100000;
    updateDisplay();
    saveGame();
  }
}, 1000);
function showNotice() {
  hideAllMenus();
  document.getElementById('noticePanel').style.display = 'block';
}
function closeNotice() {
  document.getElementById('noticePanel').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
}
  // â˜…â˜…â˜… íƒ€ì„ì–´íƒ/ì¼ë°˜ëª¨ë“œ ë²„íŠ¼ í‘œì‹œ ì²˜ë¦¬ â˜…â˜…â˜…
function togglePause() {
  if (inTimeAttack) {
    timeAttackPaused = !timeAttackPaused;
    if (timeAttackPaused) {
      document.getElementById('timerBox').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€ (ë²„íŠ¼ìœ¼ë¡œ ì¬ê°œ)';
      document.getElementById('pauseButton').textContent = 'â–¶ï¸ ì¬ê°œ';
      setGameButtonsDisabled(true); // ëª¨ë‘ ë¹„í™œì„±í™”, pauseButtonë§Œ í™œì„±
    } else {
      prev = Date.now();
      updateTimerDisplay();
      document.getElementById('pauseButton').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
      setGameButtonsDisabled(false);
    }
  }
}
window.onload = () => {
  if (localStorage.getItem('energy')) {
    document.getElementById('continueButton').style.display = 'inline-block';
  } else {
    document.getElementById('continueButton').style.display = 'none';
  }
  document.getElementById('mainMenu').style.display = 'block';
  if (localStorage.getItem('ta_energy')) {
    document.getElementById('continueTimeAttackBtn').style.display = 'inline-block';
  }
  document.getElementById('restartButton').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  document.body.addEventListener('click', () => {
    const bgm = document.getElementById('bgm');
    if (bgm.paused) bgm.play();
  }, { once: true });
};
function showAchievements() {
  document.getElementById('achievementsPanel').style.display = 'block';
}

function hideAchievements() {
  document.getElementById('achievementsPanel').style.display = 'none';
  prev = Date.now();
}

window.addEventListener('keydown', (e) => {
  if (inTimeAttack && document.getElementById('gameScreen').style.display === 'block') {
    if (e.code === 'Space') {
      timeAttackPaused = !timeAttackPaused;
      if (timeAttackPaused) {
        document.getElementById('timerBox').textContent = 'â¸ï¸ ì¼ì‹œì •ì§€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì¬ê°œ)';
      } else {
        prev = Date.now();
        updateTimerDisplay();
      }
    }
  }
});
// === [1] ì„¤ì •ì°½ ì—´ê¸°/ë‹«ê¸° ===
function showSettings() {
  hideAllMenus();
  document.getElementById('settingsPanel').style.display = 'block';

  // ë°°ê²½ ì²´í¬ ìƒíƒœ
  document.getElementById('bgToggle').checked = !(localStorage.getItem('hideBG') === '1');

  // ì–¸ì–´ ì…€ë ‰íŠ¸
  document.getElementById('langSelect').value = localStorage.getItem('lang') || 'ko';

  // ì–¸ì–´ ë°˜ì˜
  applyLanguage();
}

function closeSettings() {
  document.getElementById('settingsPanel').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'block';
}

// === [2] ë°°ê²½ on/off ===
document.getElementById('bgToggle').addEventListener('change', function() {
  localStorage.setItem('hideBG', this.checked ? '0' : '1');
  updateBGVisible();
});

function updateBGVisible() {
  const hideBG = localStorage.getItem('hideBG') === '1';
  document.getElementById('starCanvas').style.display = 'block'; // í•­ìƒ block
  window._hideBG = hideBG;
}
updateBGVisible();

// === [3] ì–¸ì–´ ë³€ê²½ ===
document.getElementById('langSelect').addEventListener('change', function() {
  localStorage.setItem('lang', this.value);
  applyLanguage();
});

function applyLanguage() {
  const lang = localStorage.getItem('lang') || 'ko';
  // label ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ë§Œ ë°”ê¿ˆ (ì‹¤ì œ ê²Œì„ ë‚´ í…ìŠ¤íŠ¸ë„ ì˜ì–´ ì¶”ê°€í•˜ë ¤ë©´ ë²ˆì—­ ë°ì´í„° ë” í•„ìš”!)
  if (lang === 'en') {
    document.getElementById('settingsTitle').textContent = 'âš™ï¸ Settings';
    document.getElementById('bgLabel').textContent = 'Show Background';
    document.getElementById('langLabel').textContent = 'Language';
    document.getElementById('resetBtn').textContent = 'Reset Game';
    document.getElementById('closeSettingsBtn').textContent = 'Close';
    // ... (í•„ìš”í•˜ë©´ ë” ì¶”ê°€)
  } else {
    document.getElementById('settingsTitle').textContent = 'âš™ï¸ ì„¤ì •';
    document.getElementById('bgLabel').textContent = 'ë°°ê²½ í‘œì‹œ';
    document.getElementById('langLabel').textContent = 'ì–¸ì–´';
    document.getElementById('resetBtn').textContent = 'ê²Œì„ ë¦¬ì…‹';
    document.getElementById('closeSettingsBtn').textContent = 'ë‹«ê¸°';
  }
}

// === [4] ê²Œì„ ë¦¬ì…‹ ===
function resetGameWithConfirm() {
  if (confirm(getT('resetConfirm'))) {
    localStorage.clear();
    location.reload();
  }
}
let inSecretMode = false;   // ë¹„ë°€ëª¨ë“œ ì—¬ë¶€
let secretAutoClick = false; // ì˜¤í† í´ë¦­ ì‘ë™ ì—¬ë¶€
let secretAutoClickInterval = null;

// ëª¨ë‹¬ ì—´ê¸°
function showSecretModePassword() {
  document.getElementById('secretModeModal').style.display = 'block';
  document.getElementById('secretPasswordInput').value = '';
}

// ëª¨ë‹¬ ë‹«ê¸°
function closeSecretModeModal() {
  document.getElementById('secretModeModal').style.display = 'none';
}

// ë¹„ë°€ë²ˆí˜¸ í™•ì¸
function checkSecretModePassword() {
  const pw = document.getElementById('secretPasswordInput').value;
  if (pw === "5293238") {
    closeSecretModeModal();
    startSecretMode();
  } else {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
  }
}

// ë¹„ë°€ëª¨ë“œ ì‹œì‘
function startSecretMode() {
  inSecretMode = true;
  inTimeAttack = false;
  inLimitedLandMode = false;
  inHardcoreMode = false;
  inInfiniteMode = false;
  gameEnded = false;

  // ëª¨ë“  ê°’ ì´ˆê¸°í™”
  energy = 0; clickPower = 1; upgradeCost = 10;
  generators = 0; generatorCost = 50;
  fusionPlants = 0; fusionCost = 500;
  antimatterPlants = 0; antimatterCost = 20000;
  dysonSpheres = 0; dysonCost = 100000;
  blackholes = 0; blackholeCost = 750000;
  bigbangs = 0; bigbangCost = 5000000;

  hideAllMenus();
  document.getElementById('gameScreen').style.display = 'block';
  document.getElementById('timerBox').style.display = 'none';
  document.getElementById('retryButton').style.display = 'none';
  document.getElementById('landLimitNotice').style.display = 'none';

  updateDisplay();
  // ì˜¤í† í´ë¦­ ë²„íŠ¼ ì¶”ê°€ (í•œ ë²ˆë§Œ ì¶”ê°€)
  if (!document.getElementById('secretAutoBtn')) {
    let btn = document.createElement('button');
    btn.id = 'secretAutoBtn';
    btn.textContent = 'ğŸ› ï¸ ì˜¤í†  í´ë¦­ í‚¤ê¸°';
    btn.onclick = toggleSecretAutoClick;
    btn.style.marginTop = '18px';
    document.getElementById('gameScreen').appendChild(btn);
  }
  document.getElementById('secretAutoBtn').style.display = 'inline-block';
  document.getElementById('secretAutoBtn').textContent = 'ğŸ› ï¸ ì˜¤í†  í´ë¦­ í‚¤ê¸°';
}

// ì˜¤í†  í´ë¦­ on/off
function toggleSecretAutoClick() {
  if (!secretAutoClick) {
    secretAutoClick = true;
    document.getElementById('secretAutoBtn').textContent = 'ğŸ› ï¸ ì˜¤í†  í´ë¦­ ë„ê¸°';
    secretAutoClickInterval = setInterval(() => {
      // ì´ˆë‹¹ 25íšŒ ì œí•œ ë§ì¶°ì¤Œ
      for (let i = 0; i < 25; i++) gainEnergy();
    }, 1000);
  } else {
    secretAutoClick = false;
    document.getElementById('secretAutoBtn').textContent = 'ğŸ› ï¸ ì˜¤í†  í´ë¦­ í‚¤ê¸°';
    clearInterval(secretAutoClickInterval);
  }
}
</script>
<div id="secretModeModal" style="display:none; position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;background:rgba(0,0,0,0.7);">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;padding:40px 30px;border-radius:20px;box-shadow:0 0 20px #000;text-align:center;">
    <div style="color:#fff;font-size:1.3em;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!</div>
    <input type="password" id="secretPasswordInput" style="font-size:1.3em; padding:10px; margin:18px 0;" autocomplete="off"/>
    <br>
    <button onclick="checkSecretModePassword()">í™•ì¸</button>
    <button onclick="closeSecretModeModal()">ë‹«ê¸°</button>
  </div>
</div>
</body>
</html>